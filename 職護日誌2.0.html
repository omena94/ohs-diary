<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index.html</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Microsoft JhengHei', sans-serif; 
            background: #D6DCDB;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .hidden { 
            display: none !important; 
        }
        
        .card {
            background: #f8f9fa;
            backdrop-filter: blur(10px);
            border: 1px solid #e9ecef;
            box-shadow: 0 8px 32px rgba(141, 107, 97, 0.15);
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 3rem;
        }

        .btn-primary, .btn-success, .btn-todo, .btn-stats, .btn-change, .btn-template, .btn-backup, .btn-supplies {
            background: #A1B0AD;
            border: none;
            color: #8D6B61;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(161, 176, 173, 0.3);
            width: 100%;
        }

        .btn-primary:hover, .btn-success:hover, .btn-todo:hover, .btn-stats:hover, .btn-change:hover, .btn-template:hover, .btn-backup:hover, .btn-supplies:hover {
            background: #8D9B98;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(141, 155, 152, 0.4);
        }

        .btn-cancel {
            background: #82898D;
            border: none;
            color: #F2EEED;
            padding: 1rem 2.5rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(130, 137, 141, 0.2);
        }

        .btn-cancel:hover {
            background: #8D6B61;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(130, 137, 141, 0.3);
        }

        .form-input {
            border: 2px solid #C6CCC0;
            transition: all 0.3s ease;
            background: #F2EEED;
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            font-size: 1.125rem;
            width: 100%;
            color: #8D6B61;
        }

        .form-input:focus {
            border-color: #C39289;
            box-shadow: 0 0 0 3px rgba(195, 146, 137, 0.15);
            background: rgba(242, 238, 237, 0.98);
            outline: none;
        }

        .header-gradient {
            color: #8D6B61;
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .section-header {
            color: #8D6B61;
            border-bottom: 2px solid #82898D;
            padding-bottom: 0.5rem;
            font-size: 1.875rem;
            font-weight: bold;
            margin-bottom: 2rem;
        }

        .entry-card {
            background: #F2EEED;
            border: 1px solid #82898D;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(141, 107, 97, 0.1);
        }

        .entry-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(141, 107, 97, 0.15);
            border-color: #82898D;
        }

        .change-card {
            background: #F2EEED;
            border: 1px solid #82898D;
            border-left: 4px solid #82898D;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(195, 146, 137, 0.1);
        }

        .change-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(195, 146, 137, 0.15);
        }

        .change-type-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .change-type-new {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .change-type-modify {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .change-type-remove {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .tag {
            background: #E3E7EA;
            color: #8D6B61;
            border: 1px solid #D6DCDB;
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .search-container {
            background: rgba(242, 238, 237, 0.9);
            border: 1px solid #82898D;
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 16px rgba(141, 107, 97, 0.1);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #F2EEED;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(141, 107, 97, 0.3);
            border: 1px solid #82898D;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #8D6B61;
            margin-bottom: 1rem;
        }

        .modal-message {
            font-size: 1.125rem;
            color: #82898D;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-confirm {
            background: #C39289;
            color: #F2EEED;
        }

        .modal-btn-confirm:hover {
            background: #E1AA8D;
            color: #8D6B61;
        }

        .modal-btn-cancel {
            background: #C6CCC0;
            color: #8D6B61;
        }

        .modal-btn-cancel:hover {
            background: #D6DCDB;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #8D6B61;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #C39289;
            color: #F2EEED;
        }

        .icon-btn {
            transition: all 0.3s ease;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .icon-btn:hover {
            transform: scale(1.1);
        }

        .edit-btn {
            background: #A1B0AD;
            color: #8D6B61;
        }

        .delete-btn {
            background: #C39289;
            color: #F2EEED;
            font-weight: bold;
            border: 2px solid #E1AA8D;
        }

        .delete-btn:hover {
            background: #C0B0A2;
            color: #F2EEED;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(192, 176, 162, 0.5);
        }

        .template-section {
            background: #E3E7EA;
            border: 1px solid #D6DCDB;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .template-btn {
            background: #E3E7EA;
            color: #8D6B61;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 0.25rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .template-btn:hover {
            background: #C39289;
            color: #F2EEED;
        }

        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            border: 2px solid #C6CCC0;
            border-radius: 0.75rem;
            padding: 0.5rem;
            background: #F2EEED;
        }

        .tag-input-container:focus-within {
            border-color: #C39289;
            box-shadow: 0 0 0 3px rgba(195, 146, 137, 0.15);
        }

        .tag-item {
            background: #C39289;
            color: #F2EEED;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 500;
        }

        .tag-remove {
            background: none;
            border: none;
            color: #F2EEED;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tag-remove:hover {
            background: rgba(242, 238, 237, 0.3);
        }

        .tag-input {
            border: none;
            outline: none;
            background: none;
            flex: 1;
            min-width: 100px;
            font-size: 1rem;
            color: #8D6B61;
        }

        .tab-container {
            display: flex;
            border-bottom: 2px solid #82898D;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #8D6B61;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #82898D;
            border-bottom-color: #82898D;
            background: #E3E7EA;
            opacity: 0.8;
        }

        .tab-btn:hover {
            background: #E3E7EA;
            opacity: 0.5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.warning {
            background: #f39c12;
        }

        .notification.error {
            background: #e74c3c;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .gap-6 { gap: 1.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-2 { gap: 0.5rem; }
        .mb-12 { margin-bottom: 3rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mt-6 { margin-top: 1.5rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .col-span-2 { grid-column: span 2; }
        .space-y-8 > * + * { margin-top: 2rem; }
        .text-center { text-align: center; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .left-5 { left: 1.25rem; }
        .top-1/2 { top: 50%; }
        .transform { transform: translateY(-50%); }
        .w-full { width: 100%; }
        .text-2xl { font-size: 1.5rem; }
        .text-xl { font-size: 1.25rem; }
        .text-lg { font-size: 1.125rem; }
        .font-bold { font-weight: bold; }
        .font-semibold { font-weight: 600; }
        .pl-14 { padding-left: 3.5rem; }
        .pr-6 { padding-right: 1.5rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .pt-8 { padding-top: 2rem; }

        @media (max-width: 768px) {
            .grid-cols-2 { grid-template-columns: 1fr; }
            .container { padding: 1rem; }
            .form-input { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mb-12 text-center">
            <h1 class="header-gradient">è·è­·å·¥ä½œæ—¥èªŒ</h1>
            <p class="text-xl" style="color: #8D6B61">è¨˜éŒ„æ¯æ—¥å·¥ä½œå…§å®¹ã€é‡è¦äº‹é …èˆ‡å·¥ä½œè®Šæ›´</p>
            <div class="mt-6" style="width: 8rem; height: 0.25rem; margin: 1.5rem auto; background: #82898D; border-radius: 2px;"></div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 3rem; max-width: 1000px; margin-left: auto; margin-right: auto;">
            <button onclick="showAddForm()" class="btn-primary">
                <span style="font-size: 1.2rem;">ğŸ“</span> æ–°å¢æ—¥èªŒ
            </button>
            <button onclick="showChangeForm()" class="btn-change">
                <span style="font-size: 1.2rem;">ğŸ”„</span> å·¥ä½œè®Šæ›´
            </button>
            <button onclick="showSuppliesModal()" class="btn-supplies">
                <span style="font-size: 1.2rem;">ğŸ¥</span> æ€¥æ•‘ç®±è€—æ
            </button>
            <button onclick="exportData()" class="btn-success">
                <span style="font-size: 1.2rem;">ğŸ“¤</span> åŒ¯å‡º
            </button>
            <button onclick="showImportModal()" class="btn-success">
                <span style="font-size: 1.2rem;">ğŸ“¥</span> åŒ¯å…¥
            </button>
            <button onclick="showTodoModal()" class="btn-todo">
                <span style="font-size: 1.2rem;">â˜</span> å¾…è¾¦
            </button>
            <button onclick="showStatsModal()" class="btn-stats">
                <span style="font-size: 1.2rem;">ğŸ“Š</span> çµ±è¨ˆ
            </button>
            <button onclick="showBackupSettings()" class="btn-backup">
                <span style="font-size: 1.2rem;">ğŸ’¾</span> å‚™ä»½
            </button>
        </div>

        <div class="search-container">
            <div class="flex flex-wrap gap-6">
                <div style="flex: 1; min-width: 20rem;">
                    <div class="relative">
                        <span class="absolute left-5 top-1/2 transform" style="color: #8D6B61; font-size: 1.5rem;">ğŸ”</span>
                        <input type="text" id="searchInput" placeholder="æœå°‹å…§å®¹..." oninput="filterContent()" class="form-input pl-14 pr-6" />
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <span style="color: #8D6B61; font-size: 1.5rem;">ğŸ“‹</span>
                    <select id="displayFilter" onchange="filterContent()" class="form-input px-6 py-4" style="width: auto; min-width: 160px;">
                        <option value="recent5">æœ€è¿‘5ç­†</option>
                        <option value="recent10">æœ€è¿‘10ç­†</option>
                        <option value="recent20">æœ€è¿‘20ç­†</option>
                        <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
                        <option value="thisMonth">æœ¬æœˆ</option>
                        <option value="lastMonth">ä¸Šæœˆ</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- æ–°å¢æ—¥èªŒè¡¨å–® -->
        <div id="formContainer" class="hidden card">
            <h2 id="formTitle" class="section-header">æ–°å¢æ—¥èªŒ</h2>
            <div class="space-y-8">
                <div class="template-section">
                    <label class="block text-sm font-semibold mb-2" style="color: #8D6B61">ğŸš€ å¿«é€Ÿç¯„æœ¬</label>
                    <div style="margin-bottom: 1rem;">
                        <button type="button" class="template-btn" onclick="insertTemplate('routine')" id="routineBtn">ä¾‹è¡Œå·¥ä½œ</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('meeting')" id="meetingBtn">æœƒè­°è¨˜éŒ„</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('emergency')" id="emergencyBtn">ç·Šæ€¥äº‹ä»¶</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('health')" id="healthBtn">å¥åº·ä¿ƒé€²</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('training')" id="trainingBtn">æ•™è‚²è¨“ç·´</button>
                    </div>
                    <div style="text-align: right;">
                        <button type="button" onclick="showTemplateEditor()" style="background: #C39289; color: #F2EEED; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                            âš™ï¸ ç·¨è¼¯ç¯„æœ¬
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">ğŸ“… æ—¥æœŸ</label>
                        <input type="date" id="date" class="form-input" />
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">ğŸ·ï¸ æ¨™ç±¤</label>
                        <div class="tag-input-container" id="tagContainer">
                            <input type="text" class="tag-input" id="tagInput" placeholder="è¼¸å…¥æ¨™ç±¤å¾ŒæŒ‰Enter..." onkeypress="handleTagInput(event)">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">âš¡ ä¸»è¦å·¥ä½œå…§å®¹</label>
                    <textarea id="mainTasks" rows="5" class="form-input" placeholder="è¨˜éŒ„ä»Šæ—¥ä¸»è¦å®Œæˆçš„å·¥ä½œ..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">ğŸ‘¨â€ğŸ’¼ ä¸»ç®¡æŒ‡ç¤ºäº‹é …</label>
                        <textarea id="managementDirectives" rows="4" class="form-input" placeholder="è¨˜éŒ„ä¸»ç®¡äº¤è¾¦çš„äº‹é …..."></textarea>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">ğŸš¨ ç·Šæ€¥äº‹ä»¶è™•ç†</label>
                        <textarea id="emergencyEvents" rows="4" class="form-input" placeholder="è¨˜éŒ„ç·Šæ€¥äº‹ä»¶çš„è™•ç†éç¨‹..."></textarea>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">ğŸ’ª å¥åº·ä¿ƒé€²æ´»å‹•</label>
                        <textarea id="healthPromotionActivities" rows="4" class="form-input" placeholder="è¨˜éŒ„å¥åº·ä¿ƒé€²ç›¸é—œæ´»å‹•..."></textarea>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #8D6B61">ğŸ“ å…¶ä»–å‚™è¨»</label>
                        <textarea id="notes" rows="4" class="form-input" placeholder="å…¶ä»–éœ€è¦è¨˜éŒ„çš„äº‹é …..."></textarea>
                    </div>
                </div>
                
                <div class="flex gap-6 pt-8">
                    <button onclick="saveEntry()" class="btn-primary">ğŸ’¾ å„²å­˜æ—¥èªŒ</button>
                    <button onclick="cancelForm()" class="btn-cancel">âœ–ï¸ å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- å·¥ä½œè®Šæ›´è¡¨å–® -->
        <div id="changeFormContainer" class="hidden card">
            <h2 id="changeFormTitle" class="section-header" style="color: #DCC677; border-bottom-color: #DCC677;">æ–°å¢å·¥ä½œè®Šæ›´è¨˜éŒ„</h2>
            <div class="space-y-8">
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ“… è®Šæ›´æ—¥æœŸ</label>
                        <input type="date" id="changeDate" class="form-input" />
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ”„ è®Šæ›´é¡å‹</label>
                        <select id="changeType" class="form-input">
                            <option value="new">æ–°å¢å·¥ä½œé …ç›®</option>
                            <option value="modify">ä¿®æ”¹å·¥ä½œå…§å®¹</option>
                            <option value="remove">ç§»é™¤å·¥ä½œé …ç›®</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ“‹ å·¥ä½œé …ç›®åç¨±</label>
                    <input type="text" id="workItem" class="form-input" placeholder="ä¾‹å¦‚ï¼šæœƒè­°å®¤å®‰å…¨å·¡æª¢ã€å¥åº·æª¢æŸ¥æµç¨‹ã€é†«ç™‚ç”¨å“ç®¡ç†..." />
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ“ åŸæœ¬å…§å®¹</label>
                        <textarea id="originalContent" rows="4" class="form-input" placeholder="è¨˜éŒ„åŸæœ¬çš„å·¥ä½œå…§å®¹æˆ–åŸ·è¡Œé »ç‡..."></textarea>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ†• è®Šæ›´å¾Œå…§å®¹</label>
                        <textarea id="newContent" rows="4" class="form-input" placeholder="è¨˜éŒ„è®Šæ›´å¾Œçš„å·¥ä½œå…§å®¹æˆ–åŸ·è¡Œé »ç‡..."></textarea>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ‘¨â€ğŸ’¼ æŒ‡ç¤ºä¾†æº</label>
                        <input type="text" id="changeSource" class="form-input" placeholder="ä¾‹å¦‚ï¼šç¶“ç†ã€æ³•è¦..." />
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ¯ è®Šæ›´åŸå› </label>
                        <textarea id="changeReason" rows="4" class="form-input" placeholder="è¨˜éŒ„è®Šæ›´çš„åŸå› æˆ–èƒŒæ™¯..."></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-lg font-semibold mb-3" style="color: #DCC677">ğŸ“‹ äº¤æ¥æ³¨æ„äº‹é …</label>
                    <textarea id="handoverNotes" rows="3" class="form-input" placeholder="è¨˜éŒ„æœªä¾†äº¤æ¥æ™‚éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„äº‹é …..."></textarea>
                </div>
                
                <div class="flex gap-6 pt-8">
                    <button onclick="saveChange()" class="btn-change">ğŸ’¾ å„²å­˜è®Šæ›´è¨˜éŒ„</button>
                    <button onclick="cancelChangeForm()" class="btn-cancel">âœ–ï¸ å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- æ¨™ç±¤é  -->
        <div class="card">
            <div class="tab-container">
                <button class="tab-btn active" onclick="showTab('journal')">ğŸ“ å·¥ä½œæ—¥èªŒ</button>
                <button class="tab-btn" onclick="showTab('changes')">ğŸ”„ å·¥ä½œè®Šæ›´è¨˜éŒ„</button>
            </div>

            <!-- å·¥ä½œæ—¥èªŒå…§å®¹ -->
            <div id="journalTab" class="tab-content active">
                <div id="entriesList">
                    <div id="noEntries" class="text-center" style="padding: 4rem 0;">
                        <div style="font-size: 5rem; margin-bottom: 1.5rem; color: #E3E7EA;">ğŸ“</div>
                        <p class="text-xl font-semibold" style="color: #8D6B61;">é–‹å§‹è¨˜éŒ„æ‚¨çš„å·¥ä½œæ—¥èªŒ</p>
                        <p style="color: #82898D; margin-top: 0.5rem;">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢æ—¥èªŒã€æŒ‰éˆ•é–‹å§‹è¨˜éŒ„</p>
                    </div>
                </div>
            </div>

            <!-- å·¥ä½œè®Šæ›´è¨˜éŒ„å…§å®¹ -->
            <div id="changesTab" class="tab-content">
                <div id="changesList">
                    <div id="noChanges" class="text-center" style="padding: 4rem 0;">
                        <div style="font-size: 5rem; margin-bottom: 1.5rem; color: #DCC677;">ğŸ”„</div>
                        <p class="text-xl font-semibold" style="color: #DCC677;">é–‹å§‹è¨˜éŒ„å·¥ä½œè®Šæ›´</p>
                        <p style="color: #82898D; margin-top: 0.5rem;">é»æ“Šä¸Šæ–¹ã€Œå·¥ä½œè®Šæ›´ã€æŒ‰éˆ•é–‹å§‹è¨˜éŒ„</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¾…è¾¦äº‹é …å½ˆçª— -->
    <div id="todoModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 700px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #A1B0AD; font-size: 1.8rem; font-weight: bold; margin: 0;">ğŸ“ å¾…è¾¦äº‹é …ç®¡ç†</h2>
                <button class="close-btn" onclick="hideTodoModal()" style="color: #A1B0AD;">âœ–</button>
            </div>
            
            <!-- æ–°å¢å¾…è¾¦äº‹é … -->
            <div style="background: #E3E7EA; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem;">
                <h3 style="color: #8D6B61; margin-bottom: 1rem; font-size: 1.1rem;">â• æ–°å¢å¾…è¾¦äº‹é …</h3>
                <div style="display: flex; gap: 1rem; align-items: end;">
                    <div style="flex: 1;">
                        <label style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #8D6B61;">äº‹é …å…§å®¹</label>
                        <input type="text" id="todoInput" placeholder="è«‹è¼¸å…¥å¾…è¾¦äº‹é …..." 
                               style="width: 100%; padding: 0.75rem; border: 2px solid #C6CCC0; border-radius: 0.5rem; font-size: 1rem;"
                               onkeypress="if(event.key==='Enter') addTodo()">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 500; margin-bottom: 0.5rem; color: #8D6B61;">å„ªå…ˆç´š</label>
                        <select id="todoPriority" style="padding: 0.75rem; border: 2px solid #C6CCC0; border-radius: 0.5rem; font-size: 1rem;">
                            <option value="high">ğŸ”´ é«˜</option>
                            <option value="normal" selected>ğŸ”µ ä¸­</option>
                            <option value="low">âšª ä½</option>
                        </select>
                    </div>
                    <button onclick="addTodo()" 
                            style="background: #A1B0AD; color: #8D6B61; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; white-space: nowrap;">
                        æ–°å¢
                    </button>
                </div>
            </div>
            
            <!-- å¾…è¾¦äº‹é …çµ±è¨ˆ -->
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <div style="flex: 1; background: #C39289; color: white; padding: 1rem; border-radius: 0.5rem; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold;" id="totalTodos">0</div>
                    <div style="font-size: 0.9rem;">ç¸½è¨ˆ</div>
                </div>
                <div style="flex: 1; background: #27ae60; color: white; padding: 1rem; border-radius: 0.5rem; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold;" id="completedTodos">0</div>
                    <div style="font-size: 0.9rem;">å·²å®Œæˆ</div>
                </div>
                <div style="flex: 1; background: #e74c3c; color: white; padding: 1rem; border-radius: 0.5rem; text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold;" id="pendingTodos">0</div>
                    <div style="font-size: 0.9rem;">å¾…å®Œæˆ</div>
                </div>
            </div>
            
            <!-- æ“ä½œæŒ‰éˆ• -->
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <button onclick="clearCompletedTodos()" 
                        style="background: #27ae60; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                    âœ… æ¸…é™¤å·²å®Œæˆ
                </button>
                <button onclick="clearAllTodos()" 
                        style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                    ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨
                </button>
                <button onclick="clearPendingTodos()" 
                        style="background: #f39c12; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                    â³ æ¸…é™¤æœªå®Œæˆ
                </button>
                <button onclick="selectDeleteMode()" 
                        style="background: #9b59b6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                    â˜‘ï¸ æ‰¹é‡åˆªé™¤
                </button>
            </div>
            
            <!-- å¾…è¾¦äº‹é …åˆ—è¡¨ -->
            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #D6DCDB; border-radius: 0.5rem; padding: 1rem; background: white;">
                <h3 style="color: #8D6B61; margin-bottom: 1rem; font-size: 1.1rem;">ğŸ“‹ å¾…è¾¦æ¸…å–®</h3>
                <div id="todosList"></div>
            </div>
        </div>
    </div>

    <!-- åŒ¯å…¥è³‡æ–™å½ˆçª— -->
    <div id="importModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #A1B0AD; font-size: 1.8rem; font-weight: bold; margin: 0;">ğŸ“¥ åŒ¯å…¥è³‡æ–™</h2>
                <button class="close-btn" onclick="hideImportModal()" style="color: #A1B0AD;">âœ–</button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: #666; margin-bottom: 1rem;">é¸æ“‡è¦åŒ¯å…¥çš„æª”æ¡ˆé¡å‹ï¼š</p>
                
                <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                    <div style="border: 2px dashed #A1B0AD; border-radius: 0.5rem; padding: 2rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“Š</div>
                        <h3 style="color: #A1B0AD; margin-bottom: 0.5rem;">Excel æª”æ¡ˆ</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">åŒ¯å…¥ä¹‹å‰åŒ¯å‡ºçš„ Excel æª”æ¡ˆ</p>
                        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelImport(event)">
                        <button onclick="document.getElementById('excelFileInput').click()" style="background: #A1B0AD; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;">é¸æ“‡ Excel æª”æ¡ˆ</button>
                    </div>
                    
                    <div style="border: 2px dashed #C0B0A2; border-radius: 0.5rem; padding: 2rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“„</div>
                        <h3 style="color: #C0B0A2; margin-bottom: 0.5rem;">JSON æª”æ¡ˆ</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">åŒ¯å…¥å®Œæ•´å‚™ä»½æª”æ¡ˆï¼ˆæ¨è–¦ï¼‰</p>
                        <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="handleJsonImport(event)">
                        <button onclick="document.getElementById('jsonFileInput').click()" style="background: #C0B0A2; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;">é¸æ“‡ JSON æª”æ¡ˆ</button>
                    </div>
                </div>
                
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 0.5rem; padding: 1rem;">
                    <h4 style="color: #856404; margin: 0 0 0.5rem 0;">âš ï¸ é‡è¦æé†’</h4>
                    <ul style="color: #856404; margin: 0; padding-left: 1.5rem; font-size: 0.9rem;">
                        <li>åŒ¯å…¥è³‡æ–™æœƒè¦†è“‹ç¾æœ‰çš„æ‰€æœ‰è¨˜éŒ„</li>
                        <li>å»ºè­°å…ˆåŒ¯å‡ºå‚™ä»½ç›®å‰çš„è³‡æ–™</li>
                        <li>JSON æ ¼å¼èƒ½å®Œæ•´ä¿ç•™æ‰€æœ‰è³‡æ–™çµæ§‹</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¯„æœ¬ç·¨è¼¯å™¨å½ˆè·³è¦–çª— -->
    <div id="templateEditor" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #DCC677; font-size: 1.8rem; font-weight: bold; margin: 0;">âš™ï¸ ç¯„æœ¬ç·¨è¼¯å™¨</h2>
                <button class="close-btn" onclick="hideTemplateEditor()" style="color: #DCC677;">âœ–</button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: #666; margin-bottom: 1rem;">æ‚¨å¯ä»¥è‡ªå®šç¾©å¿«é€Ÿç¯„æœ¬çš„å…§å®¹ï¼Œè®“æ—¥èªŒè¨˜éŒ„æ›´ç¬¦åˆæ‚¨çš„å·¥ä½œç¿’æ…£ã€‚</p>
            </div>
            
            <div style="display: grid; gap: 2rem;">
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #8D6B61;">ğŸ“‹ ç¯„æœ¬1</label>
                    <input type="text" id="routineName" class="form-input" placeholder="ç¯„æœ¬åç¨±..." style="margin-bottom: 0.5rem;">
                    <textarea id="routineTemplate" rows="4" class="form-input" placeholder="è¼¸å…¥ç¯„æœ¬å…§å®¹..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #8D6B61;">ğŸ¤ ç¯„æœ¬2</label>
                    <input type="text" id="meetingName" class="form-input" placeholder="ç¯„æœ¬åç¨±..." style="margin-bottom: 0.5rem;">
                    <textarea id="meetingTemplate" rows="4" class="form-input" placeholder="è¼¸å…¥ç¯„æœ¬å…§å®¹..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #8D6B61;">ğŸš¨ ç¯„æœ¬3</label>
                    <input type="text" id="emergencyName" class="form-input" placeholder="ç¯„æœ¬åç¨±..." style="margin-bottom: 0.5rem;">
                    <textarea id="emergencyTemplate" rows="4" class="form-input" placeholder="è¼¸å…¥ç¯„æœ¬å…§å®¹..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #8D6B61;">ğŸ’ª ç¯„æœ¬4</label>
                    <input type="text" id="healthName" class="form-input" placeholder="ç¯„æœ¬åç¨±..." style="margin-bottom: 0.5rem;">
                    <textarea id="healthTemplate" rows="4" class="form-input" placeholder="è¼¸å…¥ç¯„æœ¬å…§å®¹..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: #8D6B61;">ğŸ“š ç¯„æœ¬5</label>
                    <input type="text" id="trainingName" class="form-input" placeholder="ç¯„æœ¬åç¨±..." style="margin-bottom: 0.5rem;">
                    <textarea id="trainingTemplate" rows="4" class="form-input" placeholder="è¼¸å…¥ç¯„æœ¬å…§å®¹..."></textarea>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #E3E7EA;">
                <button onclick="saveTemplates()" style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                    âœ… å„²å­˜ç¯„æœ¬
                </button>
                <button onclick="resetTemplates()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                    ğŸ”„ é‡è¨­ç‚ºé è¨­
                </button>
                <button onclick="hideTemplateEditor()" style="background: #82898D; color: white; border: none; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                    âŒ å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let entries = [];
        let workChanges = [];
        let editingId = null;
        let editingChangeId = null;
        let todos = [];
        let todoIdCounter = 1;
        let currentTags = [];
        let currentTab = 'journal';
        let supplies = [];

        // ç¯„æœ¬å…§å®¹
        let templates = {
            routine: "âœ“ ä¾‹è¡Œå¥åº·æª¢æŸ¥\nâœ“ ç’°å¢ƒå®‰å…¨å·¡è¦–\nâœ“ é†«ç™‚ç”¨å“ç›¤é»\nâœ“ æ–‡ä»¶è¨˜éŒ„æ›´æ–°",
            meeting: "æœƒè­°ä¸»é¡Œï¼š\nåƒèˆ‡äººå“¡ï¼š\né‡è¦æ±ºè­°ï¼š\nå¾ŒçºŒè¡Œå‹•ï¼š",
            emergency: "äº‹ä»¶æ™‚é–“ï¼š\näº‹ä»¶åœ°é»ï¼š\nè™•ç†ç¶“éï¼š\nå¾ŒçºŒè¿½è¹¤ï¼š",
            health: "æ´»å‹•åç¨±ï¼š\nåƒèˆ‡äººæ•¸ï¼š\næ´»å‹•å…§å®¹ï¼š\næˆæ•ˆè©•ä¼°ï¼š",
            training: "è¨“ç·´ä¸»é¡Œï¼š\nè¬›å¸«ï¼š\nåƒèˆ‡äººå“¡ï¼š\né‡é»å…§å®¹ï¼š\nå¿ƒå¾—æ”¶ç©«ï¼š"
        };

        let templateNames = {
            routine: "ä¾‹è¡Œå·¥ä½œ",
            meeting: "æœƒè­°è¨˜éŒ„", 
            emergency: "ç·Šæ€¥äº‹ä»¶",
            health: "å¥åº·ä¿ƒé€²",
            training: "æ•™è‚²è¨“ç·´"
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadTodos();
            loadTemplates();
            loadSupplies();
            setDefaultDisplay();
            displayContent();
            updateTemplateButtons();
        });

        // é€šçŸ¥åŠŸèƒ½
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // è³‡æ–™å„²å­˜èˆ‡è¼‰å…¥
        function saveData() {
            const data = {
                entries: entries,
                workChanges: workChanges,
                todos: todos,
                todoIdCounter: todoIdCounter,
                supplies: supplies,
                templates: templates,
                templateNames: templateNames
            };
            localStorage.setItem('nursingJournalData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('nursingJournalData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    entries = data.entries || [];
                    workChanges = data.workChanges || [];
                    todos = data.todos || [];
                    todoIdCounter = data.todoIdCounter || 1;
                    supplies = data.supplies || [];
                    if (data.templates) templates = data.templates;
                    if (data.templateNames) templateNames = data.templateNames;
                    
                    // ç¢ºä¿èˆŠçš„å¾…è¾¦äº‹é …æœ‰å„ªå…ˆç´š
                    todos.forEach(todo => {
                        if (!todo.priority) todo.priority = 'normal';
                    });
                    
                } catch (e) {
                    console.error('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', e);
                }
            }
        }

        function loadTodos() {
            // å¾…è¾¦äº‹é …åŠŸèƒ½ï¼ˆæš«æ™‚ç©ºå¯¦ä½œï¼‰
        }

        function loadTemplates() {
            // è¼‰å…¥ç¯„æœ¬è¨­å®šå·²åœ¨ loadData ä¸­è™•ç†
        }

        function loadSupplies() {
            // è€—æç®¡ç†åŠŸèƒ½ï¼ˆæš«æ™‚ç©ºå¯¦ä½œï¼‰
        }

        function setDefaultDisplay() {
            document.getElementById('displayFilter').value = 'recent5';
        }

        // æ—¥èªŒåŠŸèƒ½
        function showAddForm() {
            editingId = null;
            document.getElementById('formTitle').textContent = 'æ–°å¢æ—¥èªŒ';
            document.getElementById('formContainer').classList.remove('hidden');
            document.getElementById('changeFormContainer').classList.add('hidden');
            resetForm();
            setDefaultDate();
        }

        function setDefaultDate() {
            if (!editingId) {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('date').value = today;
            }
        }

        function resetForm() {
            ['date', 'mainTasks', 'managementDirectives', 'emergencyEvents', 'healthPromotionActivities', 'notes'].forEach(field => {
                document.getElementById(field).value = '';
            });
            currentTags = [];
            updateTagDisplay();
        }

        function cancelForm() {
            document.getElementById('formContainer').classList.add('hidden');
            editingId = null;
        }

        function saveEntry() {
            const date = document.getElementById('date').value;
            const mainTasks = document.getElementById('mainTasks').value;

            if (!date) {
                showNotification('è«‹å¡«å¯«æ—¥æœŸ', 'warning');
                return;
            }

            const entry = {
                id: editingId || Date.now(),
                date: date,
                mainTasks: mainTasks,
                managementDirectives: document.getElementById('managementDirectives').value,
                emergencyEvents: document.getElementById('emergencyEvents').value,
                healthPromotionActivities: document.getElementById('healthPromotionActivities').value,
                notes: document.getElementById('notes').value,
                tags: [...currentTags],
                createdAt: editingId ? entries.find(e => e.id === editingId)?.createdAt : new Date().toISOString()
            };

            if (editingId) {
                const index = entries.findIndex(e => e.id === editingId);
                if (index !== -1) entries[index] = entry;
            } else {
                entries.unshift(entry);
            }

            entries.sort((a, b) => new Date(b.date) - new Date(a.date));
            saveData();
            displayContent();
            cancelForm();
            showNotification('âœ… æ—¥èªŒå·²å„²å­˜', 'success');
        }

        function editEntry(id) {
            const entry = entries.find(e => e.id === id);
            if (!entry) return;
            
            editingId = id;
            document.getElementById('formTitle').textContent = 'ç·¨è¼¯æ—¥èªŒ';
            
            document.getElementById('date').value = entry.date;
            document.getElementById('mainTasks').value = entry.mainTasks;
            document.getElementById('managementDirectives').value = entry.managementDirectives || '';
            document.getElementById('emergencyEvents').value = entry.emergencyEvents || '';
            document.getElementById('healthPromotionActivities').value = entry.healthPromotionActivities || '';
            document.getElementById('notes').value = entry.notes || '';
            
            currentTags = entry.tags || [];
            updateTagDisplay();
            document.getElementById('formContainer').classList.remove('hidden');
            document.getElementById('changeFormContainer').classList.add('hidden');
        }

        function deleteEntry(id) { 
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                entries = entries.filter(e => e.id !== id);
                saveData();
                displayContent();
                showNotification('âœ… è¨˜éŒ„å·²åˆªé™¤', 'success');
            }
        }

        // å·¥ä½œè®Šæ›´åŠŸèƒ½
        function showChangeForm() {
            editingChangeId = null;
            document.getElementById('changeFormTitle').textContent = 'æ–°å¢å·¥ä½œè®Šæ›´è¨˜éŒ„';
            document.getElementById('changeFormContainer').classList.remove('hidden');
            document.getElementById('formContainer').classList.add('hidden');
            resetChangeForm();
            setDefaultChangeDate();
        }

        function setDefaultChangeDate() {
            if (!editingChangeId) {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('changeDate').value = today;
            }
        }

        function resetChangeForm() {
            ['changeDate', 'workItem', 'originalContent', 'newContent', 'changeSource', 'changeReason', 'handoverNotes'].forEach(field => {
                document.getElementById(field).value = '';
            });
            document.getElementById('changeType').value = 'new';
        }

        function cancelChangeForm() {
            document.getElementById('changeFormContainer').classList.add('hidden');
            editingChangeId = null;
        }

        function saveChange() {
            const changeDate = document.getElementById('changeDate').value;
            const workItem = document.getElementById('workItem').value;
            const changeType = document.getElementById('changeType').value;

            if (!changeDate || !workItem) {
                showNotification('è«‹å¡«å¯«è®Šæ›´æ—¥æœŸå’Œå·¥ä½œé …ç›®åç¨±', 'warning');
                return;
            }

            const change = {
                id: editingChangeId || Date.now(),
                date: changeDate,
                workItem: workItem,
                changeType: changeType,
                originalContent: document.getElementById('originalContent').value,
                newContent: document.getElementById('newContent').value,
                changeSource: document.getElementById('changeSource').value,
                changeReason: document.getElementById('changeReason').value,
                handoverNotes: document.getElementById('handoverNotes').value,
                createdAt: editingChangeId ? workChanges.find(c => c.id === editingChangeId)?.createdAt : new Date().toISOString()
            };

            if (editingChangeId) {
                const index = workChanges.findIndex(c => c.id === editingChangeId);
                if (index !== -1) workChanges[index] = change;
            } else {
                workChanges.unshift(change);
            }

            workChanges.sort((a, b) => new Date(b.date) - new Date(a.date));
            saveData();
            displayContent();
            cancelChangeForm();
            showNotification('âœ… è®Šæ›´è¨˜éŒ„å·²å„²å­˜', 'success');
        }

        function editChange(id) {
            const change = workChanges.find(c => c.id === id);
            if (!change) return;
            
            editingChangeId = id;
            document.getElementById('changeFormTitle').textContent = 'ç·¨è¼¯å·¥ä½œè®Šæ›´è¨˜éŒ„';
            
            document.getElementById('changeDate').value = change.date;
            document.getElementById('workItem').value = change.workItem;
            document.getElementById('changeType').value = change.changeType;
            document.getElementById('originalContent').value = change.originalContent || '';
            document.getElementById('newContent').value = change.newContent || '';
            document.getElementById('changeSource').value = change.changeSource || '';
            document.getElementById('changeReason').value = change.changeReason || '';
            document.getElementById('handoverNotes').value = change.handoverNotes || '';
            
            document.getElementById('changeFormContainer').classList.remove('hidden');
            document.getElementById('formContainer').classList.add('hidden');
        }

        function deleteChange(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è®Šæ›´è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                workChanges = workChanges.filter(c => c.id !== id);
                saveData();
                displayContent();
                showNotification('âœ… è®Šæ›´è¨˜éŒ„å·²åˆªé™¤', 'success');
            }
        }

        // é¡¯ç¤ºå…§å®¹
        function displayContent() {
            if (currentTab === 'journal') {
                displayEntries();
            } else if (currentTab === 'changes') {
                displayChanges();
            }
        }

        function displayEntries() {
            const filteredEntries = getFilteredData(entries);
            const container = document.getElementById('entriesList');
            container.innerHTML = '';

            if (filteredEntries.length === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 4rem 0;">
                        <div style="font-size: 5rem; margin-bottom: 1.5rem; color: #E3E7EA;">ğŸ“</div>
                        <p class="text-xl font-semibold" style="color: #8D6B61;">é–‹å§‹è¨˜éŒ„æ‚¨çš„å·¥ä½œæ—¥èªŒ</p>
                        <p style="color: #82898D; margin-top: 0.5rem;">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢æ—¥èªŒã€æŒ‰éˆ•é–‹å§‹è¨˜éŒ„</p>
                    </div>
                `;
                return;
            }

            filteredEntries.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'entry-card';
                
                const tagsHtml = entry.tags && entry.tags.length > 0 ? 
                    `<div style="margin-top: 0.5rem;">
                        ${entry.tags.map(tag => `<span style="background: #C39289; color: white; padding: 0.25rem 0.5rem; border-radius: 0.5rem; font-size: 0.75rem; margin-right: 0.5rem;">${escapeHtml(tag)}</span>`).join('')}
                    </div>` : '';
                
                entryDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                        <div>
                            <h3 style="font-size: 1.5rem; font-weight: bold; color: #8D6B61;">${formatDate(entry.date)}</h3>
                            ${tagsHtml}
                        </div>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="icon-btn edit-btn" title="ç·¨è¼¯æ—¥èªŒ" onclick="editEntry(${entry.id})">âœï¸</button>
                            <button class="icon-btn delete-btn" title="åˆªé™¤æ—¥èªŒ" onclick="deleteEntry(${entry.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        ${entry.mainTasks ? createFieldSection(entry.mainTasks, 'âš¡ ä¸»è¦å·¥ä½œå…§å®¹', 'col-span-2') : ''}
                        ${createFieldSection(entry.managementDirectives, 'ğŸ‘¨â€ğŸ’¼ ä¸»ç®¡æŒ‡ç¤ºäº‹é …')}
                        ${createFieldSection(entry.emergencyEvents, 'ğŸš¨ ç·Šæ€¥äº‹ä»¶è™•ç†')}
                        ${createFieldSection(entry.healthPromotionActivities, 'ğŸ’ª å¥åº·ä¿ƒé€²æ´»å‹•')}
                        ${createFieldSection(entry.notes, 'ğŸ“ å…¶ä»–å‚™è¨»')}
                    </div>
                `;
                container.appendChild(entryDiv);
            });
        }

        function displayChanges() {
            const filteredChanges = getFilteredData(workChanges);
            const container = document.getElementById('changesList');
            container.innerHTML = '';

            if (filteredChanges.length === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 4rem 0;">
                        <div style="font-size: 5rem; margin-bottom: 1.5rem; color: #DCC677;">ğŸ”„</div>
                        <p class="text-xl font-semibold" style="color: #DCC677;">é–‹å§‹è¨˜éŒ„å·¥ä½œè®Šæ›´</p>
                        <p style="color: #82898D; margin-top: 0.5rem;">é»æ“Šä¸Šæ–¹ã€Œå·¥ä½œè®Šæ›´ã€æŒ‰éˆ•é–‹å§‹è¨˜éŒ„</p>
                    </div>
                `;
                return;
            }

            filteredChanges.forEach(change => {
                const changeDiv = document.createElement('div');
                changeDiv.className = 'change-card';
                
                const typeText = {
                    'new': 'æ–°å¢å·¥ä½œé …ç›®',
                    'modify': 'ä¿®æ”¹å·¥ä½œå…§å®¹', 
                    'remove': 'ç§»é™¤å·¥ä½œé …ç›®'
                };

                const typeBadge = `<span class="change-type-badge change-type-${change.changeType}">${typeText[change.changeType]}</span>`;
                
                changeDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                        <div>
                            <h3 style="font-size: 1.5rem; font-weight: bold; color: #DCC677;">${formatDate(change.date)}</h3>
                            ${typeBadge}
                            <h4 style="font-size: 1.25rem; font-weight: 600; color: #333; margin-top: 0.5rem;">${escapeHtml(change.workItem)}</h4>
                        </div>
                        <div style="display: flex; gap: 0.75rem;">
                            <button class="icon-btn edit-btn" title="ç·¨è¼¯è®Šæ›´è¨˜éŒ„" onclick="editChange(${change.id})">âœï¸</button>
                            <button class="icon-btn delete-btn" title="åˆªé™¤è®Šæ›´è¨˜éŒ„" onclick="deleteChange(${change.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        ${createFieldSection(change.originalContent, 'ğŸ“ åŸæœ¬å…§å®¹')}
                        ${createFieldSection(change.newContent, 'ğŸ†• è®Šæ›´å¾Œå…§å®¹')}
                        ${createFieldSection(change.changeSource, 'ğŸ‘¨â€ğŸ’¼ æŒ‡ç¤ºä¾†æº')}
                        ${createFieldSection(change.changeReason, 'ğŸ¯ è®Šæ›´åŸå› ')}
                        ${change.handoverNotes ? createFieldSection(change.handoverNotes, 'ğŸ“‹ äº¤æ¥æ³¨æ„äº‹é …', 'col-span-2') : ''}
                    </div>
                `;
                container.appendChild(changeDiv);
            });
        }

        function createFieldSection(content, title, className = '') {
            if (!content) return '';
            
            const headerClass = className === 'col-span-2' ? 
                'font-weight: bold; font-size: 1.125rem; margin-bottom: 0.75rem; color: #8D6B61; border-bottom: 2px solid #82898D; padding-bottom: 0.5rem;' :
                'font-weight: 600; margin-bottom: 0.75rem; color: #8D6B61;';
            
            return `
                <div ${className ? `class="${className}"` : ''}>
                    <h4 style="${headerClass}">${title}</h4>
                    <div class="tag">
                        <p style="line-height: 1.6; white-space: pre-wrap; color: #2c3e50; font-weight: 500;">${escapeHtml(content)}</p>
                    </div>
                </div>
            `;
        }

        function getFilteredData(data) {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const displayValue = document.getElementById('displayFilter').value;
            
            let filtered = data.filter(item => {
                return Object.values(item).some(value => 
                    String(value).toLowerCase().includes(searchTerm)
                );
            });

            const currentDate = new Date();
            const currentMonth = currentDate.toISOString().slice(0, 7);
            const lastMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1).toISOString().slice(0, 7);

            switch(displayValue) {
                case 'recent5': return filtered.slice(0, 5);
                case 'recent10': return filtered.slice(0, 10);
                case 'recent20': return filtered.slice(0, 20);
                case 'all': return filtered;
                case 'thisMonth': return filtered.filter(item => item.date.startsWith(currentMonth));
                case 'lastMonth': return filtered.filter(item => item.date.startsWith(lastMonth));
                default: return filtered.slice(0, 5);
            }
        }

        function filterContent() {
            displayContent();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            return `${dateString} (${weekdays[date.getDay()]})`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ¨™ç±¤é åˆ‡æ›
        function showTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            displayContent();
        }

        // æ¨™ç±¤åŠŸèƒ½
        function handleTagInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const tagInput = document.getElementById('tagInput');
                const tagText = tagInput.value.trim();
                
                if (tagText && !currentTags.includes(tagText)) {
                    currentTags.push(tagText);
                    updateTagDisplay();
                    tagInput.value = '';
                }
            }
        }

        function removeTag(tagToRemove) {
            currentTags = currentTags.filter(tag => tag !== tagToRemove);
            updateTagDisplay();
        }

        function updateTagDisplay() {
            const container = document.getElementById('tagContainer');
            const tagInput = document.getElementById('tagInput');
            
            const existingTags = container.querySelectorAll('.tag-item');
            existingTags.forEach(tag => tag.remove());
            
            currentTags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    ${escapeHtml(tag)}
                    <button type="button" class="tag-remove" onclick="removeTag('${tag}')">Ã—</button>
                `;
                container.insertBefore(tagElement, tagInput);
            });
        }

        // ç¯„æœ¬åŠŸèƒ½
        function insertTemplate(templateType) {
            if (templates[templateType]) {
                const mainTasksField = document.getElementById('mainTasks');
                const currentContent = mainTasksField.value;
                const newContent = currentContent ? currentContent + '\n\n' + templates[templateType] : templates[templateType];
                mainTasksField.value = newContent;
                mainTasksField.focus();
            }
        }

        function showTemplateEditor() {
            document.getElementById('templateEditor').classList.remove('hidden');
            loadTemplateEditor();
        }

        function hideTemplateEditor() {
            document.getElementById('templateEditor').classList.add('hidden');
        }

        function loadTemplateEditor() {
            document.getElementById('routineName').value = templateNames.routine || '';
            document.getElementById('meetingName').value = templateNames.meeting || '';
            document.getElementById('emergencyName').value = templateNames.emergency || '';
            document.getElementById('healthName').value = templateNames.health || '';
            document.getElementById('trainingName').value = templateNames.training || '';
            
            document.getElementById('routineTemplate').value = templates.routine || '';
            document.getElementById('meetingTemplate').value = templates.meeting || '';
            document.getElementById('emergencyTemplate').value = templates.emergency || '';
            document.getElementById('healthTemplate').value = templates.health || '';
            document.getElementById('trainingTemplate').value = templates.training || '';
        }

        function saveTemplates() {
            templateNames.routine = document.getElementById('routineName').value || 'ç¯„æœ¬1';
            templateNames.meeting = document.getElementById('meetingName').value || 'ç¯„æœ¬2';
            templateNames.emergency = document.getElementById('emergencyName').value || 'ç¯„æœ¬3';
            templateNames.health = document.getElementById('healthName').value || 'ç¯„æœ¬4';
            templateNames.training = document.getElementById('trainingName').value || 'ç¯„æœ¬5';
            
            templates.routine = document.getElementById('routineTemplate').value;
            templates.meeting = document.getElementById('meetingTemplate').value;
            templates.emergency = document.getElementById('emergencyTemplate').value;
            templates.health = document.getElementById('healthTemplate').value;
            templates.training = document.getElementById('trainingTemplate').value;
            
            updateTemplateButtons();
            saveData();
            hideTemplateEditor();
            showNotification('âœ… ç¯„æœ¬å·²å„²å­˜', 'success');
        }

        function resetTemplates() {
            if (confirm('ç¢ºå®šè¦é‡è¨­ç‚ºé è¨­ç¯„æœ¬å—ï¼Ÿé€™å°‡æœƒè¦†è“‹æ‚¨ç›®å‰çš„è‡ªè¨‚ç¯„æœ¬ã€‚')) {
                templateNames = {
                    routine: "ä¾‹è¡Œå·¥ä½œ",
                    meeting: "æœƒè­°è¨˜éŒ„", 
                    emergency: "ç·Šæ€¥äº‹ä»¶",
                    health: "å¥åº·ä¿ƒé€²",
                    training: "æ•™è‚²è¨“ç·´"
                };
                
                templates = {
                    routine: "âœ“ ä¾‹è¡Œå¥åº·æª¢æŸ¥\nâœ“ ç’°å¢ƒå®‰å…¨å·¡è¦–\nâœ“ é†«ç™‚ç”¨å“ç›¤é»\nâœ“ æ–‡ä»¶è¨˜éŒ„æ›´æ–°",
                    meeting: "æœƒè­°ä¸»é¡Œï¼š\nåƒèˆ‡äººå“¡ï¼š\né‡è¦æ±ºè­°ï¼š\nå¾ŒçºŒè¡Œå‹•ï¼š",
                    emergency: "äº‹ä»¶æ™‚é–“ï¼š\näº‹ä»¶åœ°é»ï¼š\nè™•ç†ç¶“éï¼š\nå¾ŒçºŒè¿½è¹¤ï¼š",
                    health: "æ´»å‹•åç¨±ï¼š\nåƒèˆ‡äººæ•¸ï¼š\næ´»å‹•å…§å®¹ï¼š\næˆæ•ˆè©•ä¼°ï¼š",
                    training: "è¨“ç·´ä¸»é¡Œï¼š\nè¬›å¸«ï¼š\nåƒèˆ‡äººå“¡ï¼š\né‡é»å…§å®¹ï¼š\nå¿ƒå¾—æ”¶ç©«ï¼š"
                };
                
                loadTemplateEditor();
                updateTemplateButtons();
                saveData();
                showNotification('âœ… ç¯„æœ¬å·²é‡è¨­ç‚ºé è¨­å€¼', 'success');
            }
        }

        function updateTemplateButtons() {
            document.getElementById('routineBtn').textContent = templateNames.routine;
            document.getElementById('meetingBtn').textContent = templateNames.meeting;
            document.getElementById('emergencyBtn').textContent = templateNames.emergency;
            document.getElementById('healthBtn').textContent = templateNames.health;
            document.getElementById('trainingBtn').textContent = templateNames.training;
        }

        // åŒ¯å‡ºåŠŸèƒ½
        function exportData() {
            try {
                // å»ºç«‹å·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                
                // åŒ¯å‡ºæ—¥èªŒè³‡æ–™
                if (entries.length > 0) {
                    const journalData = entries.map(entry => ({
                        'æ—¥æœŸ': entry.date,
                        'ä¸»è¦å·¥ä½œå…§å®¹': entry.mainTasks || '',
                        'ä¸»ç®¡æŒ‡ç¤ºäº‹é …': entry.managementDirectives || '',
                        'ç·Šæ€¥äº‹ä»¶è™•ç†': entry.emergencyEvents || '',
                        'å¥åº·ä¿ƒé€²æ´»å‹•': entry.healthPromotionActivities || '',
                        'å…¶ä»–å‚™è¨»': entry.notes || '',
                        'æ¨™ç±¤': (entry.tags || []).join(', '),
                        'å»ºç«‹æ™‚é–“': entry.createdAt || ''
                    }));
                    const ws1 = XLSX.utils.json_to_sheet(journalData);
                    XLSX.utils.book_append_sheet(wb, ws1, 'å·¥ä½œæ—¥èªŒ');
                }
                
                // åŒ¯å‡ºè®Šæ›´è¨˜éŒ„
                if (workChanges.length > 0) {
                    const changesData = workChanges.map(change => ({
                        'è®Šæ›´æ—¥æœŸ': change.date,
                        'è®Šæ›´é¡å‹': change.changeType === 'new' ? 'æ–°å¢å·¥ä½œé …ç›®' : 
                                   change.changeType === 'modify' ? 'ä¿®æ”¹å·¥ä½œå…§å®¹' : 'ç§»é™¤å·¥ä½œé …ç›®',
                        'å·¥ä½œé …ç›®åç¨±': change.workItem || '',
                        'åŸæœ¬å…§å®¹': change.originalContent || '',
                        'è®Šæ›´å¾Œå…§å®¹': change.newContent || '',
                        'æŒ‡ç¤ºä¾†æº': change.changeSource || '',
                        'è®Šæ›´åŸå› ': change.changeReason || '',
                        'äº¤æ¥æ³¨æ„äº‹é …': change.handoverNotes || '',
                        'å»ºç«‹æ™‚é–“': change.createdAt || ''
                    }));
                    const ws2 = XLSX.utils.json_to_sheet(changesData);
                    XLSX.utils.book_append_sheet(wb, ws2, 'å·¥ä½œè®Šæ›´è¨˜éŒ„');
                }
                
                // åŒ¯å‡ºå¾…è¾¦äº‹é …
                if (todos.length > 0) {
                    const todoData = todos.map(todo => ({
                        'å¾…è¾¦äº‹é …': todo.text || '',
                        'å„ªå…ˆç´š': todo.priority === 'high' ? 'é«˜' : todo.priority === 'low' ? 'ä½' : 'ä¸­',
                        'ç‹€æ…‹': todo.completed ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ',
                        'å»ºç«‹æ™‚é–“': todo.createdAt || '',
                        'å®Œæˆæ™‚é–“': todo.completedAt || ''
                    }));
                    const ws3 = XLSX.utils.json_to_sheet(todoData);
                    XLSX.utils.book_append_sheet(wb, ws3, 'å¾…è¾¦äº‹é …');
                }
                
                // ç”Ÿæˆæª”æ¡ˆåç¨±
                const today = new Date().toISOString().split('T')[0];
                const filename = `è·è­·å·¥ä½œæ—¥èªŒ_${today}.xlsx`;
                
                // ä¸‹è¼‰æª”æ¡ˆ
                XLSX.writeFile(wb, filename);
                showNotification('âœ… Excel æª”æ¡ˆå·²åŒ¯å‡º', 'success');
                
                // åŒæ™‚åŒ¯å‡º JSON å‚™ä»½
                exportJsonBackup();
                
            } catch (error) {
                console.error('åŒ¯å‡ºå¤±æ•—:', error);
                showNotification('âŒ åŒ¯å‡ºå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        function exportJsonBackup() {
            const backupData = {
                entries: entries,
                workChanges: workChanges,
                todos: todos,
                supplies: supplies,
                templates: templates,
                templateNames: templateNames,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            const today = new Date().toISOString().split('T')[0];
            link.download = `è·è­·å·¥ä½œæ—¥èªŒ_å®Œæ•´å‚™ä»½_${today}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // åŒ¯å…¥åŠŸèƒ½
        function showImportModal() {
            const modal = document.getElementById('importModal');
            if (modal) {
                modal.classList.remove('hidden');
            } else {
                showNotification('åŒ¯å…¥åŠŸèƒ½è¼‰å…¥å¤±æ•—', 'error');
            }
        }

        function hideImportModal() {
            const modal = document.getElementById('importModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            
            // é‡ç½®æª”æ¡ˆè¼¸å…¥ - åŠ å…¥å®‰å…¨æª¢æŸ¥
            const excelInput = document.getElementById('excelFileInput');
            const jsonInput = document.getElementById('jsonFileInput');
            
            if (excelInput) excelInput.value = '';
            if (jsonInput) jsonInput.value = '';
        }

        function handleExcelImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm('åŒ¯å…¥è³‡æ–™æœƒè¦†è“‹ç¾æœ‰çš„æ‰€æœ‰è¨˜éŒ„ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿå»ºè­°å…ˆåŒ¯å‡ºå‚™ä»½ã€‚')) {
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // é‡ç½®è³‡æ–™
                    entries = [];
                    workChanges = [];
                    todos = [];
                    
                    // åŒ¯å…¥å·¥ä½œæ—¥èªŒ
                    if (workbook.SheetNames.includes('å·¥ä½œæ—¥èªŒ')) {
                        const worksheet = workbook.Sheets['å·¥ä½œæ—¥èªŒ'];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        entries = jsonData.map((row, index) => ({
                            id: Date.now() + index,
                            date: row['æ—¥æœŸ'] || '',
                            mainTasks: row['ä¸»è¦å·¥ä½œå…§å®¹'] || '',
                            managementDirectives: row['ä¸»ç®¡æŒ‡ç¤ºäº‹é …'] || '',
                            emergencyEvents: row['ç·Šæ€¥äº‹ä»¶è™•ç†'] || '',
                            healthPromotionActivities: row['å¥åº·ä¿ƒé€²æ´»å‹•'] || '',
                            notes: row['å…¶ä»–å‚™è¨»'] || '',
                            tags: row['æ¨™ç±¤'] ? row['æ¨™ç±¤'].split(', ').filter(tag => tag.trim()) : [],
                            createdAt: row['å»ºç«‹æ™‚é–“'] || new Date().toISOString()
                        }));
                    }
                    
                    // åŒ¯å…¥å·¥ä½œè®Šæ›´è¨˜éŒ„
                    if (workbook.SheetNames.includes('å·¥ä½œè®Šæ›´è¨˜éŒ„')) {
                        const worksheet = workbook.Sheets['å·¥ä½œè®Šæ›´è¨˜éŒ„'];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        workChanges = jsonData.map((row, index) => ({
                            id: Date.now() + index + 10000,
                            date: row['è®Šæ›´æ—¥æœŸ'] || '',
                            changeType: row['è®Šæ›´é¡å‹'] === 'æ–°å¢å·¥ä½œé …ç›®' ? 'new' :
                                       row['è®Šæ›´é¡å‹'] === 'ä¿®æ”¹å·¥ä½œå…§å®¹' ? 'modify' : 'remove',
                            workItem: row['å·¥ä½œé …ç›®åç¨±'] || '',
                            originalContent: row['åŸæœ¬å…§å®¹'] || '',
                            newContent: row['è®Šæ›´å¾Œå…§å®¹'] || '',
                            changeSource: row['æŒ‡ç¤ºä¾†æº'] || '',
                            changeReason: row['è®Šæ›´åŸå› '] || '',
                            handoverNotes: row['äº¤æ¥æ³¨æ„äº‹é …'] || '',
                            createdAt: row['å»ºç«‹æ™‚é–“'] || new Date().toISOString()
                        }));
                    }
                    
                    // åŒ¯å…¥å¾…è¾¦äº‹é …
                    if (workbook.SheetNames.includes('å¾…è¾¦äº‹é …')) {
                        const worksheet = workbook.Sheets['å¾…è¾¦äº‹é …'];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        todos = jsonData.map((row, index) => ({
                            id: Date.now() + index + 20000,
                            text: row['å¾…è¾¦äº‹é …'] || '',
                            priority: row['å„ªå…ˆç´š'] === 'é«˜' ? 'high' : row['å„ªå…ˆç´š'] === 'ä½' ? 'low' : 'normal',
                            completed: row['ç‹€æ…‹'] === 'å·²å®Œæˆ',
                            createdAt: row['å»ºç«‹æ™‚é–“'] || new Date().toISOString(),
                            completedAt: row['å®Œæˆæ™‚é–“'] || null
                        }));
                    }
                    
                    // å„²å­˜è³‡æ–™ä¸¦æ›´æ–°é¡¯ç¤º
                    saveData();
                    displayContent();
                    hideImportModal();
                    showNotification('âœ… Excel è³‡æ–™åŒ¯å…¥æˆåŠŸ', 'success');
                    
                } catch (error) {
                    console.error('Excel åŒ¯å…¥å¤±æ•—:', error);
                    showNotification('âŒ Excel åŒ¯å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function handleJsonImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm('åŒ¯å…¥è³‡æ–™æœƒè¦†è“‹ç¾æœ‰çš„æ‰€æœ‰è¨˜éŒ„ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿå»ºè­°å…ˆåŒ¯å‡ºå‚™ä»½ã€‚')) {
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // é©—è­‰è³‡æ–™æ ¼å¼
                    if (!backupData || typeof backupData !== 'object') {
                        throw new Error('ç„¡æ•ˆçš„å‚™ä»½æª”æ¡ˆæ ¼å¼');
                    }
                    
                    // åŒ¯å…¥è³‡æ–™
                    entries = backupData.entries || [];
                    workChanges = backupData.workChanges || [];
                    todos = backupData.todos || [];
                    supplies = backupData.supplies || [];
                    
                    if (backupData.templates) {
                        templates = backupData.templates;
                    }
                    if (backupData.templateNames) {
                        templateNames = backupData.templateNames;
                    }
                    
                    // å„²å­˜è³‡æ–™ä¸¦æ›´æ–°é¡¯ç¤º
                    saveData();
                    displayContent();
                    updateTemplateButtons();
                    hideImportModal();
                    showNotification('âœ… JSON å‚™ä»½æª”æ¡ˆåŒ¯å…¥æˆåŠŸ', 'success');
                    
                } catch (error) {
                    console.error('JSON åŒ¯å…¥å¤±æ•—:', error);
                    showNotification('âŒ JSON åŒ¯å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // å¾…è¾¦äº‹é …åŠŸèƒ½
        function showTodoModal() {
            const modal = document.getElementById('todoModal');
            if (modal) {
                modal.classList.remove('hidden');
                displayTodos();
            } else {
                console.error('todoModal element not found');
                showNotification('å¾…è¾¦äº‹é …åŠŸèƒ½è¼‰å…¥å¤±æ•—', 'error');
            }
        }

        function hideTodoModal() {
            const modal = document.getElementById('todoModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function addTodo() {
            const todoInput = document.getElementById('todoInput');
            const todoPriority = document.getElementById('todoPriority');
            
            if (!todoInput || !todoPriority) {
                showNotification('å¾…è¾¦äº‹é …è¼¸å…¥æ¡†è¼‰å…¥å¤±æ•—', 'error');
                return;
            }
            
            const todoText = todoInput.value.trim();
            
            if (!todoText) {
                showNotification('è«‹è¼¸å…¥å¾…è¾¦äº‹é …å…§å®¹', 'warning');
                return;
            }
            
            const newTodo = {
                id: todoIdCounter++,
                text: todoText,
                completed: false,
                createdAt: new Date().toISOString(),
                priority: todoPriority.value
            };
            
            todos.unshift(newTodo);
            todoInput.value = '';
            todoPriority.value = 'normal';
            
            saveData();
            displayTodos();
            showNotification('âœ… å¾…è¾¦äº‹é …å·²æ–°å¢', 'success');
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                todo.completedAt = todo.completed ? new Date().toISOString() : null;
                saveData();
                displayTodos();
            }
        }

        function deleteTodo(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å¾…è¾¦äº‹é …å—ï¼Ÿ')) {
                todos = todos.filter(t => t.id !== id);
                saveData();
                displayTodos();
                showNotification('âœ… å¾…è¾¦äº‹é …å·²åˆªé™¤', 'success');
            }
        }

        function editTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            const newText = prompt('ä¿®æ”¹å¾…è¾¦äº‹é …ï¼š', todo.text);
            if (newText && newText.trim() !== todo.text) {
                todo.text = newText.trim();
                saveData();
                displayTodos();
                showNotification('âœ… å¾…è¾¦äº‹é …å·²æ›´æ–°', 'success');
            }
        }

        function displayTodos() {
            const container = document.getElementById('todosList');
            
            if (!container) {
                console.error('todosList container not found');
                return;
            }
            
            container.innerHTML = '';
            
            // æ›´æ–°çµ±è¨ˆè³‡è¨Š - åŠ å…¥å®‰å…¨æª¢æŸ¥
            const totalCount = todos.length;
            const completedCount = todos.filter(t => t.completed).length;
            const pendingCount = totalCount - completedCount;
            
            const totalElement = document.getElementById('totalTodos');
            const completedElement = document.getElementById('completedTodos');
            const pendingElement = document.getElementById('pendingTodos');
            
            if (totalElement) totalElement.textContent = totalCount;
            if (completedElement) completedElement.textContent = completedCount;
            if (pendingElement) pendingElement.textContent = pendingCount;
            
            // æ‰¹é‡åˆªé™¤æ¨¡å¼çš„æ§åˆ¶é¢æ¿
            if (isSelectMode && todos.length > 0) {
                const controlPanel = document.createElement('div');
                controlPanel.style.cssText = `
                    background: #f8f9fa;
                    border: 2px solid #9b59b6;
                    border-radius: 0.5rem;
                    padding: 1rem;
                    margin-bottom: 1rem;
                    display: flex;
                    gap: 1rem;
                    align-items: center;
                    justify-content: space-between;
                `;
                
                controlPanel.innerHTML = `
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <span style="color: #9b59b6; font-weight: bold;">ğŸ“‹ æ‰¹é‡åˆªé™¤æ¨¡å¼</span>
                        <span style="color: #666; font-size: 0.9rem;">å·²é¸æ“‡: ${selectedTodos.size} é …</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="selectAllTodos()" 
                                style="background: #3498db; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.3rem; cursor: pointer; font-size: 0.8rem;">
                            ${selectedTodos.size === todos.length ? 'å–æ¶ˆå…¨é¸' : 'å…¨é¸'}
                        </button>
                        <button onclick="deleteSelectedTodos()" 
                                style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.3rem; cursor: pointer; font-size: 0.8rem;">
                            åˆªé™¤é¸ä¸­
                        </button>
                        <button onclick="selectDeleteMode()" 
                                style="background: #95a5a6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.3rem; cursor: pointer; font-size: 0.8rem;">
                            é€€å‡ºæ¨¡å¼
                        </button>
                    </div>
                `;
                
                container.appendChild(controlPanel);
            }
            
            if (todos.length === 0) {
                container.innerHTML += `
                    <div class="text-center" style="padding: 2rem 0; color: #82898D;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                        <p>é‚„æ²’æœ‰å¾…è¾¦äº‹é …</p>
                    </div>
                `;
                return;
            }
            
            const sortedTodos = [...todos].sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                const priorityOrder = { high: 0, normal: 1, low: 2 };
                return priorityOrder[a.priority || 'normal'] - priorityOrder[b.priority || 'normal'];
            });
            
            sortedTodos.forEach(todo => {
                const todoDiv = document.createElement('div');
                todoDiv.className = 'todo-item';
                
                const isSelected = selectedTodos.has(todo.id);
                const bgColor = isSelected ? '#ffebee' : (todo.completed ? '#E3E7EA' : '#F2EEED');
                const borderColor = isSelected ? '#e74c3c' : '#D6DCDB';
                
                todoDiv.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    padding: 1rem;
                    margin-bottom: 0.5rem;
                    background: ${bgColor};
                    border: 1px solid ${borderColor};
                    border-radius: 0.5rem;
                    transition: all 0.3s ease;
                    opacity: ${todo.completed ? '0.7' : '1'};
                    cursor: ${isSelectMode ? 'pointer' : 'default'};
                `;
                
                if (isSelectMode) {
                    todoDiv.onclick = (e) => toggleSelectTodo(todo.id, e);
                }
                
                const priorityColor = {
                    high: '#e74c3c',
                    normal: '#3498db',
                    low: '#95a5a6'
                };
                
                const priorityText = {
                    high: 'é«˜',
                    normal: 'ä¸­',
                    low: 'ä½'
                };
                
                const priority = todo.priority || 'normal';
                
                const selectCheckbox = isSelectMode ? `
                    <div style="display: flex; align-items: center;">
                        <input type="checkbox" 
                               ${isSelected ? 'checked' : ''}
                               style="width: 1.2rem; height: 1.2rem; cursor: pointer; margin-right: 0.5rem;"
                               onclick="toggleSelectTodo(${todo.id}, event)">
                    </div>
                ` : '';
                
                const normalCheckbox = !isSelectMode ? `
                    <input type="checkbox" 
                           ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${todo.id})"
                           style="width: 1.2rem; height: 1.2rem; cursor: pointer;">
                ` : '';
                
                todoDiv.innerHTML = `
                    ${selectCheckbox}
                    ${normalCheckbox}
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <span style="background: ${priorityColor[priority]}; color: white; padding: 0.2rem 0.5rem; border-radius: 0.3rem; font-size: 0.75rem; font-weight: bold;">
                                ${priorityText[priority]}
                            </span>
                            <span style="font-size: 0.8rem; color: #666;">
                                ${formatDateTime(todo.createdAt)}
                            </span>
                        </div>
                        <p style="margin: 0; font-weight: 500; color: #333; text-decoration: ${todo.completed ? 'line-through' : 'none'};">
                            ${escapeHtml(todo.text)}
                        </p>
                        ${todo.completed && todo.completedAt ? `<small style="color: #666;">å®Œæˆæ–¼ï¼š${formatDateTime(todo.completedAt)}</small>` : ''}
                    </div>
                    ${!isSelectMode ? `
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="editTodo(${todo.id})" 
                                style="background: #A1B0AD; color: #8D6B61; border: none; padding: 0.5rem; border-radius: 0.3rem; cursor: pointer; font-size: 0.8rem;">
                            âœï¸
                        </button>
                        <button onclick="deleteTodo(${todo.id})" 
                                style="background: #C39289; color: #F2EEED; border: none; padding: 0.5rem; border-radius: 0.3rem; cursor: pointer; font-size: 0.8rem;">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                    ` : ''}
                `;
                
                container.appendChild(todoDiv);
            });
        }

        function formatDateTime(isoString) {
            if (!isoString) return '';
            try {
                const date = new Date(isoString);
                return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            } catch (e) {
                return '';
            }
        }

        let isSelectMode = false;
        let selectedTodos = new Set();

        function clearCompletedTodos() {
            const completedCount = todos.filter(t => t.completed).length;
            if (completedCount === 0) {
                showNotification('æ²’æœ‰å·²å®Œæˆçš„å¾…è¾¦äº‹é …', 'warning');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦æ¸…é™¤ ${completedCount} å€‹å·²å®Œæˆçš„å¾…è¾¦äº‹é …å—ï¼Ÿ`)) {
                todos = todos.filter(t => !t.completed);
                saveData();
                displayTodos();
                showNotification('âœ… å·²æ¸…é™¤å®Œæˆçš„å¾…è¾¦äº‹é …', 'success');
            }
        }

        function clearAllTodos() {
            if (todos.length === 0) {
                showNotification('æ²’æœ‰å¾…è¾¦äº‹é …å¯ä»¥æ¸…é™¤', 'warning');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦æ¸…é™¤å…¨éƒ¨ ${todos.length} å€‹å¾…è¾¦äº‹é …å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) {
                todos = [];
                selectedTodos.clear();
                isSelectMode = false;
                saveData();
                displayTodos();
                showNotification('âœ… å·²æ¸…é™¤å…¨éƒ¨å¾…è¾¦äº‹é …', 'success');
            }
        }

        function clearPendingTodos() {
            const pendingCount = todos.filter(t => !t.completed).length;
            if (pendingCount === 0) {
                showNotification('æ²’æœ‰æœªå®Œæˆçš„å¾…è¾¦äº‹é …', 'warning');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦æ¸…é™¤ ${pendingCount} å€‹æœªå®Œæˆçš„å¾…è¾¦äº‹é …å—ï¼Ÿ`)) {
                todos = todos.filter(t => t.completed);
                saveData();
                displayTodos();
                showNotification('âœ… å·²æ¸…é™¤æœªå®Œæˆçš„å¾…è¾¦äº‹é …', 'success');
            }
        }

        function selectDeleteMode() {
            isSelectMode = !isSelectMode;
            selectedTodos.clear();
            displayTodos();
            
            if (isSelectMode) {
                showNotification('ğŸ“‹ æ‰¹é‡åˆªé™¤æ¨¡å¼ï¼šå‹¾é¸è¦åˆªé™¤çš„é …ç›®', 'warning');
            }
        }

        function toggleSelectTodo(id, event) {
            event.stopPropagation();
            
            if (selectedTodos.has(id)) {
                selectedTodos.delete(id);
            } else {
                selectedTodos.add(id);
            }
            
            // æ›´æ–°è¦–è¦ºæ•ˆæœ
            const todoElement = event.target.closest('.todo-item');
            if (todoElement) {
                if (selectedTodos.has(id)) {
                    todoElement.style.background = '#ffebee';
                    todoElement.style.borderColor = '#e74c3c';
                } else {
                    const todo = todos.find(t => t.id === id);
                    todoElement.style.background = todo && todo.completed ? '#E3E7EA' : '#F2EEED';
                    todoElement.style.borderColor = '#D6DCDB';
                }
            }
        }

        function deleteSelectedTodos() {
            if (selectedTodos.size === 0) {
                showNotification('è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„å¾…è¾¦äº‹é …', 'warning');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ${selectedTodos.size} å€‹é¸ä¸­çš„å¾…è¾¦äº‹é …å—ï¼Ÿ`)) {
                todos = todos.filter(t => !selectedTodos.has(t.id));
                selectedTodos.clear();
                isSelectMode = false;
                saveData();
                displayTodos();
                showNotification('âœ… å·²åˆªé™¤é¸ä¸­çš„å¾…è¾¦äº‹é …', 'success');
            }
        }

        function selectAllTodos() {
            if (selectedTodos.size === todos.length) {
                selectedTodos.clear();
            } else {
                selectedTodos.clear();
                todos.forEach(todo => selectedTodos.add(todo.id));
            }
            displayTodos();
        }

        // çµ±è¨ˆåŠŸèƒ½ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        function showStatsModal() {
            const totalEntries = entries.length;
            const totalChanges = workChanges.length;
            const thisMonthEntries = entries.filter(e => {
                const currentMonth = new Date().toISOString().slice(0, 7);
                return e.date.startsWith(currentMonth);
            }).length;
            
            showNotification(`ğŸ“Š çµ±è¨ˆï¼šå…± ${totalEntries} ç­†æ—¥èªŒï¼Œ${totalChanges} ç­†è®Šæ›´è¨˜éŒ„ï¼Œæœ¬æœˆ ${thisMonthEntries} ç­†`, 'success');
        }

        // æ€¥æ•‘ç®±è€—æåŠŸèƒ½ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        function showSuppliesModal() {
            showNotification('æ€¥æ•‘ç®±è€—æç®¡ç†åŠŸèƒ½é–‹ç™¼ä¸­...', 'warning');
        }

        // å‚™ä»½è¨­å®šåŠŸèƒ½
        function showBackupSettings() {
            const modal = document.getElementById('backupModal');
            if (modal) {
                modal.classList.remove('hidden');
            } else {
                // å¦‚æœæ²’æœ‰å‚™ä»½æ¨¡æ…‹æ¡†ï¼Œç›´æ¥é¡¯ç¤ºå‚™ä»½é¸é …
                showBackupOptions();
            }
        }

        function showBackupOptions() {
            const backupOptions = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: #F2EEED; border-radius: 1rem; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                        <h2 style="color: #8D6B61; margin-bottom: 1.5rem; font-size: 1.5rem; text-align: center;">ğŸ’¾ å‚™ä»½èˆ‡é‚„åŸ</h2>
                        
                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: #8D6B61; margin-bottom: 1rem;">ğŸ“¤ åŒ¯å‡ºå‚™ä»½</h3>
                            <div style="display: grid; gap: 0.5rem;">
                                <button onclick="exportJsonBackup(); closeBackupModal();" 
                                        style="background: #A1B0AD; color: #8D6B61; border: none; padding: 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                                    ğŸ“„ åŒ¯å‡º JSON å®Œæ•´å‚™ä»½
                                </button>
                                <button onclick="exportData(); closeBackupModal();" 
                                        style="background: #C39289; color: #F2EEED; border: none; padding: 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                                    ğŸ“Š åŒ¯å‡º Excel æ ¼å¼
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: #8D6B61; margin-bottom: 1rem;">ğŸ“¥ åŒ¯å…¥å‚™ä»½</h3>
                            <div style="display: grid; gap: 0.5rem;">
                                <button onclick="closeBackupModal(); showImportModal();" 
                                        style="background: #82898D; color: #F2EEED; border: none; padding: 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                                    ğŸ“¥ åŒ¯å…¥å‚™ä»½æª”æ¡ˆ
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: #8D6B61; margin-bottom: 1rem;">ğŸ“Š ç›®å‰è³‡æ–™çµ±è¨ˆ</h3>
                            <div style="background: #E3E7EA; padding: 1rem; border-radius: 0.5rem; font-size: 0.9rem;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <div>ğŸ“ å·¥ä½œæ—¥èªŒï¼š<strong>${entries.length}</strong> ç­†</div>
                                    <div>ğŸ”„ è®Šæ›´è¨˜éŒ„ï¼š<strong>${workChanges.length}</strong> ç­†</div>
                                    <div>â˜ å¾…è¾¦äº‹é …ï¼š<strong>${todos.length}</strong> ç­†</div>
                                    <div>ğŸ’¾ ç¯„æœ¬è¨­å®šï¼š<strong>5</strong> å€‹</div>
                                </div>
                                <div style="margin-top: 0.5rem; color: #666; font-size: 0.8rem;">
                                    æœ€å¾Œå„²å­˜ï¼š${getLastSaveTime()}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #e74c3c; margin-bottom: 1rem;">âš ï¸ å±éšªæ“ä½œ</h3>
                            <button onclick="clearAllData()" 
                                    style="background: #e74c3c; color: white; border: none; padding: 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; width: 100%;">
                                ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™
                            </button>
                        </div>
                        
                        <div style="text-align: center;">
                            <button onclick="closeBackupModal()" 
                                    style="background: #95a5a6; color: white; border: none; padding: 0.75rem 2rem; border-radius: 0.5rem; cursor: pointer;">
                                é—œé–‰
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const modalDiv = document.createElement('div');
            modalDiv.id = 'tempBackupModal';
            modalDiv.innerHTML = backupOptions;
            document.body.appendChild(modalDiv);
        }

        function closeBackupModal() {
            const tempModal = document.getElementById('tempBackupModal');
            if (tempModal) {
                tempModal.remove();
            }
            
            const modal = document.getElementById('backupModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function getLastSaveTime() {
            const saved = localStorage.getItem('nursingJournalData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    const lastEntry = entries[0];
                    const lastChange = workChanges[0];
                    const lastTodo = todos[0];
                    
                    let latestTime = null;
                    
                    if (lastEntry && lastEntry.createdAt) {
                        latestTime = new Date(lastEntry.createdAt);
                    }
                    
                    if (lastChange && lastChange.createdAt) {
                        const changeTime = new Date(lastChange.createdAt);
                        if (!latestTime || changeTime > latestTime) {
                            latestTime = changeTime;
                        }
                    }
                    
                    if (lastTodo && lastTodo.createdAt) {
                        const todoTime = new Date(lastTodo.createdAt);
                        if (!latestTime || todoTime > latestTime) {
                            latestTime = todoTime;
                        }
                    }
                    
                    if (latestTime) {
                        return `${latestTime.getMonth() + 1}/${latestTime.getDate()} ${latestTime.getHours().toString().padStart(2, '0')}:${latestTime.getMinutes().toString().padStart(2, '0')}`;
                    }
                } catch (e) {
                    console.error('å–å¾—æœ€å¾Œå„²å­˜æ™‚é–“å¤±æ•—:', e);
                }
            }
            return 'å°šæœªå„²å­˜';
        }

        function clearAllData() {
            const totalItems = entries.length + workChanges.length + todos.length;
            
            if (totalItems === 0) {
                showNotification('æ²’æœ‰è³‡æ–™éœ€è¦æ¸…é™¤', 'warning');
                return;
            }
            
            const confirmMessage = `âš ï¸ å±éšªæ“ä½œç¢ºèª âš ï¸\n\nå³å°‡æ¸…é™¤ä»¥ä¸‹æ‰€æœ‰è³‡æ–™ï¼š\nâ€¢ ${entries.length} ç­†å·¥ä½œæ—¥èªŒ\nâ€¢ ${workChanges.length} ç­†è®Šæ›´è¨˜éŒ„\nâ€¢ ${todos.length} ç­†å¾…è¾¦äº‹é …\nâ€¢ æ‰€æœ‰ç¯„æœ¬è¨­å®š\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼\n\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ`;
            
            if (confirm(confirmMessage)) {
                const doubleConfirm = confirm('ğŸš¨ æœ€å¾Œç¢ºèª ğŸš¨\n\nè³‡æ–™æ¸…é™¤å¾Œå°‡ç„¡æ³•å¾©åŸï¼\nå»ºè­°å…ˆåŒ¯å‡ºå‚™ä»½ã€‚\n\nçœŸçš„è¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ');
                
                if (doubleConfirm) {
                    // æ¸…é™¤æ‰€æœ‰è³‡æ–™
                    entries = [];
                    workChanges = [];
                    todos = [];
                    supplies = [];
                    selectedTodos.clear();
                    isSelectMode = false;
                    
                    // é‡è¨­ç¯„æœ¬ç‚ºé è¨­å€¼
                    templates = {
                        routine: "âœ“ ä¾‹è¡Œå¥åº·æª¢æŸ¥\nâœ“ ç’°å¢ƒå®‰å…¨å·¡è¦–\nâœ“ é†«ç™‚ç”¨å“ç›¤é»\nâœ“ æ–‡ä»¶è¨˜éŒ„æ›´æ–°",
                        meeting: "æœƒè­°ä¸»é¡Œï¼š\nåƒèˆ‡äººå“¡ï¼š\né‡è¦æ±ºè­°ï¼š\nå¾ŒçºŒè¡Œå‹•ï¼š",
                        emergency: "äº‹ä»¶æ™‚é–“ï¼š\näº‹ä»¶åœ°é»ï¼š\nè™•ç†ç¶“éï¼š\nå¾ŒçºŒè¿½è¹¤ï¼š",
                        health: "æ´»å‹•åç¨±ï¼š\nåƒèˆ‡äººæ•¸ï¼š\næ´»å‹•å…§å®¹ï¼š\næˆæ•ˆè©•ä¼°ï¼š",
                        training: "è¨“ç·´ä¸»é¡Œï¼š\nè¬›å¸«ï¼š\nåƒèˆ‡äººå“¡ï¼š\né‡é»å…§å®¹ï¼š\nå¿ƒå¾—æ”¶ç©«ï¼š"
                    };
                    
                    templateNames = {
                        routine: "ä¾‹è¡Œå·¥ä½œ",
                        meeting: "æœƒè­°è¨˜éŒ„", 
                        emergency: "ç·Šæ€¥äº‹ä»¶",
                        health: "å¥åº·ä¿ƒé€²",
                        training: "æ•™è‚²è¨“ç·´"
                    };
                    
                    // å„²å­˜ä¸¦æ›´æ–°é¡¯ç¤º
                    saveData();
                    displayContent();
                    updateTemplateButtons();
                    closeBackupModal();
                    
                    showNotification('âœ… æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤', 'success');
                }
            }
        }

        function createBackupSchedule() {
            // è‡ªå‹•å‚™ä»½åŠŸèƒ½ï¼ˆå¯é¸ï¼‰
            showNotification('è‡ªå‹•å‚™ä»½åŠŸèƒ½é–‹ç™¼ä¸­...', 'warning');
        }
    </script>
</body>
</html>

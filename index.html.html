<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>職護工作日誌</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Microsoft JhengHei', sans-serif; 
            background: var(--primary-sage);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .hidden { 
            display: none !important; 
        }
        
        :root {
            --primary-sage: #D6DCDB;      /* 141 - 主要背景色 */
            --secondary-mint: #C6CCC0;     /* 146 - 次要背景色 */
            --neutral-grey: #82898D;       /* 142 - 中性灰色 */
            --warm-peach: #E1AA8D;         /* 147 - 溫暖桃色 */
            --soft-brown: #C0B0A2;         /* 143 - 柔和棕色 */
            --light-cream: #F2EEED;        /* 148 - 淺奶油色 */
            --deep-brown: #8D6B61;         /* 144 - 深棕色 */
            --cool-sage: #A1B0AD;          /* 149 - 冷調鼠尾草 */
            --pale-blue: #E3E7EA;          /* 145 - 淡藍色 */
            --dusty-rose: #C39289;         /* 150 - 塵玫瑰色 */
            
            /* 新增淺色按鈕顏色 */
            --button-dark: #A1B0AD;        /* 淺色按鈕主色 */
            --button-dark-hover: #8D9B98;  /* 淺色按鈕懸停色 */
        }

        .card {
            background: #f8f9fa;
            backdrop-filter: blur(10px);
            border: 1px solid #e9ecef;
            box-shadow: 0 8px 32px rgba(141, 107, 97, 0.15);
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 3rem;
        }

        /* 統一按鈕樣式 - 使用淺色按鈕，包含備份按鈕和急救箱按鈕 */
        .btn-primary,
        .btn-success,
        .btn-todo,
        .btn-stats,
        .btn-change,
        .btn-template,
        .btn-backup,
        .btn-supplies {
            background: var(--button-dark);
            border: none;
            color: var(--deep-brown);
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(161, 176, 173, 0.3);
            width: 100%;
        }

        .btn-primary:hover,
        .btn-success:hover,
        .btn-todo:hover,
        .btn-stats:hover,
        .btn-change:hover,
        .btn-template:hover,
        .btn-backup:hover,
        .btn-supplies:hover {
            background: var(--button-dark-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(141, 155, 152, 0.4);
        }

        .btn-cancel {
            background: var(--neutral-grey);
            border: none;
            color: var(--light-cream);
            padding: 1rem 2.5rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(130, 137, 141, 0.2);
        }

        .btn-cancel:hover {
            background: var(--deep-brown);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(130, 137, 141, 0.3);
        }

        .form-input {
            border: 2px solid var(--secondary-mint);
            transition: all 0.3s ease;
            background: var(--light-cream);
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            font-size: 1.125rem;
            width: 100%;
            color: var(--deep-brown);
        }

        .form-input:focus {
            border-color: var(--dusty-rose);
            box-shadow: 0 0 0 3px rgba(195, 146, 137, 0.15);
            background: rgba(242, 238, 237, 0.98);
            outline: none;
        }

        .header-gradient {
            color: var(--deep-brown);
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .section-header {
            color: var(--deep-brown);
            border-bottom: 2px solid var(--neutral-grey);
            padding-bottom: 0.5rem;
            font-size: 1.875rem;
            font-weight: bold;
            margin-bottom: 2rem;
        }

        .entry-card {
            background: var(--light-cream);
            border: 1px solid var(--neutral-grey);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(141, 107, 97, 0.1);
        }

        .entry-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(141, 107, 97, 0.15);
            border-color: var(--neutral-grey);
        }

        .change-card {
            background: var(--light-cream);
            border: 1px solid var(--neutral-grey);
            border-left: 4px solid var(--neutral-grey);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(195, 146, 137, 0.1);
        }

        .change-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(195, 146, 137, 0.15);
        }

        .change-type-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .change-type-new {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .change-type-modify {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .change-type-remove {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .tag {
            background: var(--pale-blue);
            color: var(--deep-brown);
            border: 1px solid var(--primary-sage);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .search-container {
            background: rgba(242, 238, 237, 0.9);
            border: 1px solid var(--neutral-grey);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 16px rgba(141, 107, 97, 0.1);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--light-cream);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(141, 107, 97, 0.3);
            border: 1px solid var(--neutral-grey);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--deep-brown);
            margin-bottom: 1rem;
        }

        .modal-message {
            font-size: 1.125rem;
            color: var(--neutral-grey);
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-confirm {
            background: var(--dusty-rose);
            color: var(--light-cream);
        }

        .modal-btn-confirm:hover {
            background: var(--warm-peach);
            color: var(--deep-brown);
        }

        .modal-btn-cancel {
            background: var(--secondary-mint);
            color: var(--deep-brown);
        }

        .modal-btn-cancel:hover {
            background: var(--primary-sage);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--deep-brown);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--dusty-rose);
            color: var(--light-cream);
        }

        .icon-btn {
            transition: all 0.3s ease;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .icon-btn:hover {
            transform: scale(1.1);
        }

        .edit-btn {
            background: var(--cool-sage);
            color: var(--deep-brown);
        }

        .delete-btn {
            background: var(--dusty-rose);
            color: var(--light-cream);
            font-weight: bold;
            border: 2px solid var(--warm-peach);
        }

        .delete-btn:hover {
            background: var(--soft-brown);
            color: var(--light-cream);
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(192, 176, 162, 0.5);
        }

        .template-section {
            background: var(--pale-blue);
            border: 1px solid var(--primary-sage);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .template-btn {
            background: var(--pale-blue);
            color: var(--deep-brown);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 0.25rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .template-btn:hover {
            background: var(--dusty-rose);
            color: var(--light-cream);
        }

        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            border: 2px solid var(--secondary-mint);
            border-radius: 0.75rem;
            padding: 0.5rem;
            background: var(--light-cream);
        }

        .tag-input-container:focus-within {
            border-color: var(--dusty-rose);
            box-shadow: 0 0 0 3px rgba(195, 146, 137, 0.15);
        }

        .tag-item {
            background: var(--dusty-rose);
            color: var(--light-cream);
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 500;
        }

        .tag-remove {
            background: none;
            border: none;
            color: var(--light-cream);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tag-remove:hover {
            background: rgba(242, 238, 237, 0.3);
        }

        .tag-input {
            border: none;
            outline: none;
            background: none;
            flex: 1;
            min-width: 100px;
            font-size: 1rem;
            color: var(--deep-brown);
        }

        .tab-container {
            display: flex;
            border-bottom: 2px solid var(--neutral-grey);
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: var(--deep-brown);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: var(--neutral-grey);
            border-bottom-color: var(--neutral-grey);
            background: var(--pale-blue);
            opacity: 0.8;
        }

        .tab-btn:hover {
            background: var(--pale-blue);
            opacity: 0.5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .gap-6 { gap: 1.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-2 { gap: 0.5rem; }
        .mb-12 { margin-bottom: 3rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mt-6 { margin-top: 1.5rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .col-span-2 { grid-column: span 2; }
        .space-y-8 > * + * { margin-top: 2rem; }
        .text-center { text-align: center; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .left-5 { left: 1.25rem; }
        .top-1/2 { top: 50%; }
        .transform { transform: translateY(-50%); }
        .w-full { width: 100%; }
        .text-2xl { font-size: 1.5rem; }
        .text-xl { font-size: 1.25rem; }
        .text-lg { font-size: 1.125rem; }
        .font-bold { font-weight: bold; }
        .font-semibold { font-weight: 600; }
        .pl-14 { padding-left: 3.5rem; }
        .pr-6 { padding-right: 1.5rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .pt-8 { padding-top: 2rem; }

        @media (max-width: 768px) {
            .grid-cols-2 { grid-template-columns: 1fr; }
            .container { padding: 1rem; }
            .form-input { font-size: 1rem; }
        }

        /* 修復耗材刪除按鈕樣式 */
        .supply-delete-btn {
            background: #e74c3c !important;
            color: white !important;
            border: none !important;
            padding: 0.4rem 0.6rem !important;
            border-radius: 0.25rem !important;
            cursor: pointer !important;
            font-size: 0.8rem !important;
            transition: all 0.3s ease !important;
        }

        .supply-delete-btn:hover {
            background: #c0392b !important;
            transform: scale(1.05) !important;
        }

        .supply-edit-btn {
            background: var(--cool-sage) !important;
            color: var(--deep-brown) !important;
            border: none !important;
            padding: 0.4rem 0.6rem !important;
            border-radius: 0.25rem !important;
            cursor: pointer !important;
            font-size: 0.8rem !important;
            transition: all 0.3s ease !important;
        }

        .supply-edit-btn:hover {
            background: #8D9B98 !important;
        }

        .update-delete-btn {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mb-12 text-center">
            <h1 class="header-gradient">職護工作日誌</h1>
            <p class="text-xl" style="color: var(--deep-brown)">記錄每日工作內容、重要事項與工作變更</p>
            <div class="mt-6" style="width: 8rem; height: 0.25rem; margin: 1.5rem auto; background: var(--neutral-grey); border-radius: 2px;"></div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 3rem; max-width: 1000px; margin-left: auto; margin-right: auto;">
            <button onclick="showAddForm()" class="btn-primary" style="width: 100%;">
                <span style="font-size: 1.2rem;">📝</span> 新增日誌
            </button>
            <button onclick="showChangeForm()" class="btn-change" style="width: 100%;">
                <span style="font-size: 1.2rem;">🔄</span> 工作變更
            </button>
            <button onclick="showSuppliesModal()" class="btn-supplies" style="width: 100%;">
                <span style="font-size: 1.2rem;">🏥</span> 急救箱耗材
            </button>
            <button onclick="exportData()" class="btn-success" style="width: 100%;">
                <span style="font-size: 1.2rem;">📤</span> 匯出
            </button>
            <button onclick="showImportModal()" class="btn-success" style="width: 100%;">
                <span style="font-size: 1.2rem;">📥</span> 匯入
            </button>
            <button onclick="showTodoModal()" class="btn-todo" style="width: 100%;">
                <span style="font-size: 1.2rem;">☐</span> 待辦
            </button>
            <button onclick="showStatsModal()" class="btn-stats" style="width: 100%;">
                <span style="font-size: 1.2rem;">📊</span> 統計
            </button>
            <button onclick="showBackupSettings()" class="btn-backup">
                <span style="font-size: 1.2rem;">💾</span> 備份
            </button>
        </div>

        <div class="search-container">
            <div class="flex flex-wrap gap-6">
                <div style="flex: 1; min-width: 20rem;">
                    <div class="relative">
                        <span class="absolute left-5 top-1/2 transform" style="color: var(--deep-brown); font-size: 1.5rem;">🔍</span>
                        <input type="text" id="searchInput" placeholder="搜尋內容..." oninput="filterContent()" class="form-input pl-14 pr-6" />
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <span style="color: var(--deep-brown); font-size: 1.5rem;">📋</span>
                    <select id="displayFilter" onchange="filterContent()" class="form-input px-6 py-4" style="width: auto; min-width: 160px;">
                        <option value="recent5">最近5筆</option>
                        <option value="recent10">最近10筆</option>
                        <option value="recent20">最近20筆</option>
                        <option value="all">全部顯示</option>
                        <option value="thisMonth">本月</option>
                        <option value="lastMonth">上月</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 新增日誌表單 -->
        <div id="formContainer" class="hidden card">
            <h2 id="formTitle" class="section-header">新增日誌</h2>
            <div class="space-y-8">
                <div class="template-section">
                    <label class="block text-sm font-semibold mb-2" style="color: var(--deep-brown)">🚀 快速範本</label>
                    <div style="margin-bottom: 1rem;">
                        <button type="button" class="template-btn" onclick="insertTemplate('routine')" id="routineBtn">例行工作</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('meeting')" id="meetingBtn">會議記錄</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('emergency')" id="emergencyBtn">緊急事件</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('health')" id="healthBtn">健康促進</button>
                        <button type="button" class="template-btn" onclick="insertTemplate('training')" id="trainingBtn">教育訓練</button>
                    </div>
                    <div style="text-align: right;">
                        <button type="button" onclick="showTemplateEditor()" style="background: var(--dusty-rose); color: var(--light-cream); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.85rem; font-weight: 500;">
                            ⚙️ 編輯範本
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">📅 日期</label>
                        <input type="date" id="date" class="form-input" />
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">🏷️ 標籤</label>
                        <div class="tag-input-container" id="tagContainer">
                            <input type="text" class="tag-input" id="tagInput" placeholder="輸入標籤後按Enter..." onkeypress="handleTagInput(event)">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">⚡ 主要工作內容</label>
                    <textarea id="mainTasks" rows="5" class="form-input" placeholder="記錄今日主要完成的工作..."></textarea>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">👨‍💼 主管指示事項</label>
                        <textarea id="managementDirectives" rows="4" class="form-input" placeholder="記錄主管交辦的事項..."></textarea>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">🚨 緊急事件處理</label>
                        <textarea id="emergencyEvents" rows="4" class="form-input" placeholder="記錄緊急事件的處理過程..."></textarea>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">💪 健康促進活動</label>
                        <textarea id="healthPromotionActivities" rows="4" class="form-input" placeholder="記錄健康促進相關活動..."></textarea>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: var(--deep-brown)">📝 其他備註</label>
                        <textarea id="notes" rows="4" class="form-input" placeholder="其他需要記錄的事項..."></textarea>
                    </div>
                </div>
                
                <div class="flex gap-6 pt-8">
                    <button onclick="saveEntry()" class="btn-primary">💾 儲存日誌</button>
                    <button onclick="cancelForm()" class="btn-cancel">✖️ 取消</button>
                </div>
            </div>
        </div>

        <!-- 工作變更表單 -->
        <div id="changeFormContainer" class="hidden card">
            <h2 id="changeFormTitle" class="section-header" style="color: #DCC677; border-bottom-color: #DCC677;">新增工作變更記錄</h2>
            <div class="space-y-8">
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">📅 變更日期</label>
                        <input type="date" id="changeDate" class="form-input" />
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">🔄 變更類型</label>
                        <select id="changeType" class="form-input">
                            <option value="new">新增工作項目</option>
                            <option value="modify">修改工作內容</option>
                            <option value="remove">移除工作項目</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-lg font-semibold mb-3" style="color: #DCC677">📋 工作項目名稱</label>
                    <input type="text" id="workItem" class="form-input" placeholder="例如：會議室安全巡檢、健康檢查流程、醫療用品管理..." />
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">📝 原本內容</label>
                        <textarea id="originalContent" rows="4" class="form-input" placeholder="記錄原本的工作內容或執行頻率..."></textarea>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">🆕 變更後內容</label>
                        <textarea id="newContent" rows="4" class="form-input" placeholder="記錄變更後的工作內容或執行頻率..."></textarea>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">👨‍💼 指示來源</label>
                        <input type="text" id="changeSource" class="form-input" placeholder="例如：經理、法規..." />
                    </div>
                    <div>
                        <label class="block text-lg font-semibold mb-3" style="color: #DCC677">🎯 變更原因</label>
                        <textarea id="changeReason" rows="4" class="form-input" placeholder="記錄變更的原因或背景..."></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-lg font-semibold mb-3" style="color: #DCC677">📋 交接注意事項</label>
                    <textarea id="handoverNotes" rows="3" class="form-input" placeholder="記錄未來交接時需要特別注意的事項..."></textarea>
                </div>
                
                <div class="flex gap-6 pt-8">
                    <button onclick="saveChange()" class="btn-change">💾 儲存變更記錄</button>
                    <button onclick="cancelChangeForm()" class="btn-cancel">✖️ 取消</button>
                </div>
            </div>
        </div>

        <!-- 標籤頁 -->
        <div class="card">
            <div class="tab-container">
                <button class="tab-btn active" onclick="showTab('journal')">📝 工作日誌</button>
                <button class="tab-btn" onclick="showTab('changes')">🔄 工作變更記錄</button>
            </div>

            <!-- 工作日誌內容 -->
            <div id="journalTab" class="tab-content active">
                <div id="entriesList">
                    <div id="noEntries" class="text-center" style="padding: 4rem 0;">
                        <div style="font-size: 5rem; margin-bottom: 1.5rem; color: var(--pale-blue);">📝</div>
                        <p class="text-xl font-semibold" style="color: var(--deep-brown);">開始記錄您的工作日誌</p>
                        <p style="color: var(--neutral-grey); margin-top: 0.5rem;">點擊上方「新增日誌」按鈕開始記錄</p>
                    </div>
                </div>
            </div>

            <!-- 工作變更記錄內容 -->
            <div id="changesTab" class="tab-content">
                <div id="changesList">
                    <div id="noChanges" class="text-center" style="padding: 4rem 0;">
                        <div style="font-size: 5rem; margin-bottom: 1.5rem; color: #DCC677;">🔄</div>
                        <p class="text-xl font-semibold" style="color: #DCC677;">開始記錄工作變更</p>
                        <p style="color: var(--neutral-grey); margin-top: 0.5rem;">點擊上方「工作變更」按鈕開始記錄</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 刪除確認彈窗 -->
    <div id="deleteModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-title">⚠️ 確認刪除</div>
            <div class="modal-message">確定要刪除這筆記錄嗎？<br>此操作無法復原。</div>
            <div class="modal-buttons">
                <button id="confirmDelete" class="modal-btn modal-btn-confirm">確定刪除</button>
                <button id="cancelDelete" class="modal-btn modal-btn-cancel">取消</button>
            </div>
        </div>
    </div>

    <!-- 待辦事項彈窗 -->
    <div id="todoModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div style="font-size: 1.5rem; font-weight: bold; color: var(--deep-brown);">☐ 待辦事項</div>
                <button class="close-btn" onclick="hideTodoModal()">✖</button>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 2rem;">
                <input type="text" id="todoInput" style="flex: 1; padding: 0.75rem; border: 2px solid var(--secondary-mint); border-radius: 0.5rem; font-size: 1rem;" placeholder="新增待辦事項..." onkeypress="handleTodoKeyPress(event)">
                <button onclick="addTodo()" style="background: var(--dusty-rose); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">新增</button>
            </div>
            <div id="todoList"></div>
        </div>
    </div>

    <!-- 統計彈窗 -->
    <div id="statsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #AE78AB; font-size: 1.8rem; font-weight: bold; margin: 0;">📊 數據統計分析</h2>
                <button class="close-btn" onclick="hideStatsModal()" style="color: #AE78AB;">✖</button>
            </div>
            <div id="statsContent">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: linear-gradient(135deg, var(--pale-blue), var(--neutral-grey)); padding: 1.5rem; border-radius: 1rem; text-align: center; color: #666;">
                        <div id="totalEntries" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; color: #555;">0</div>
                        <div style="font-size: 0.9rem; opacity: 0.8; color: #777;">總日誌數</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--pale-blue), var(--neutral-grey)); padding: 1.5rem; border-radius: 1rem; text-align: center; color: #666;">
                        <div id="totalChanges" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; color: #555;">0</div>
                        <div style="font-size: 0.9rem; opacity: 0.8; color: #777;">工作變更數</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--pale-blue), var(--neutral-grey)); padding: 1.5rem; border-radius: 1rem; text-align: center; color: #666;">
                        <div id="thisMonthEntries" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; color: #555;">0</div>
                        <div style="font-size: 0.9rem; opacity: 0.8; color: #777;">本月日誌</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--pale-blue), var(--neutral-grey)); padding: 1.5rem; border-radius: 1rem; text-align: center; color: #666;">
                        <div id="totalTodos" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem; color: #555;">0</div>
                        <div style="font-size: 0.9rem; opacity: 0.8; color: #777;">待辦事項</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 匯入資料彈窗 -->
    <div id="importModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: var(--cool-sage); font-size: 1.8rem; font-weight: bold; margin: 0;">📥 匯入資料</h2>
                <button class="close-btn" onclick="hideImportModal()" style="color: var(--cool-sage);">✖</button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: #666; margin-bottom: 1rem;">選擇要匯入的檔案類型：</p>
                
                <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                    <div style="border: 2px dashed var(--cool-sage); border-radius: 0.5rem; padding: 2rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">📊</div>
                        <h3 style="color: var(--cool-sage); margin-bottom: 0.5rem;">Excel 檔案</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">匯入之前匯出的 Excel 檔案</p>
                        <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelImport(event)">
                        <button onclick="document.getElementById('excelFileInput').click()" style="background: var(--cool-sage); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;">選擇 Excel 檔案</button>
                    </div>
                    
                    <div style="border: 2px dashed var(--soft-brown); border-radius: 0.5rem; padding: 2rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">📄</div>
                        <h3 style="color: var(--soft-brown); margin-bottom: 0.5rem;">JSON 檔案</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">匯入完整備份檔案（推薦）</p>
                        <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="handleJsonImport(event)">
                        <button onclick="document.getElementById('jsonFileInput').click()" style="background: var(--soft-brown); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer;">選擇 JSON 檔案</button>
                    </div>
                </div>
                
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 0.5rem; padding: 1rem;">
                    <h4 style="color: #856404; margin: 0 0 0.5rem 0;">⚠️ 重要提醒</h4>
                    <ul style="color: #856404; margin: 0; padding-left: 1.5rem; font-size: 0.9rem;">
                        <li>匯入資料會覆蓋現有的所有記錄</li>
                        <li>建議先匯出備份目前的資料</li>
                        <li>JSON 格式能完整保留所有資料結構</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 急救箱耗材管理彈窗 -->
    <div id="suppliesModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #e74c3c; font-size: 1.8rem; font-weight: bold; margin: 0;">🏥 急救箱耗材管理</h2>
                <button class="close-btn" onclick="hideSuppliesModal()" style="color: #e74c3c;">✖</button>
            </div>
            
            <!-- 新增耗材表單 -->
            <div id="addSupplyForm" style="background: var(--pale-blue); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem;">
                <h3 style="color: var(--deep-brown); margin-bottom: 1rem; font-weight: bold;">➕ 新增/編輯耗材</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <input type="text" id="supplyName" placeholder="耗材名稱" class="form-input" style="padding: 0.5rem;">
                    <input type="number" id="supplyQuantity" placeholder="數量" class="form-input" style="padding: 0.5rem;" min="0">
                    <input type="number" id="supplyMinStock" placeholder="最低庫存" class="form-input" style="padding: 0.5rem;" min="0">
                    <input type="date" id="supplyExpiry" class="form-input" style="padding: 0.5rem;">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button onclick="addSupply()" id="addSupplyBtn" style="background: #27ae60; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500;">
                        ➕ 新增耗材
                    </button>
                    <button onclick="cancelSupplyEdit()" id="cancelSupplyBtn" style="background: var(--neutral-grey); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 500; display: none;">
                        ❌ 取消編輯
                    </button>
                </div>
            </div>

            <!-- 耗材列表 -->
            <div style="margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="color: var(--deep-brown); font-weight: bold;">📋 耗材清單</h3>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                            <input type="checkbox" id="selectAllSupplies" onchange="toggleSelectAll()" style="cursor: pointer;">
                            <span>全選</span>
                        </label>
                        <button onclick="deleteSelectedSupplies()" id="deleteSelectedBtn" class="update-delete-btn" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; display: none;">
                            🗑️ 刪除選中
                        </button>
                        <select id="suppliesFilter" onchange="filterSupplies()" class="form-input" style="width: auto; padding: 0.5rem; font-size: 0.9rem;">
                            <option value="all">全部顯示</option>
                            <option value="lowStock">庫存不足</option>
                            <option value="expired">已過期</option>
                            <option value="expiringSoon">即將過期</option>
                        </select>
                        <button onclick="exportSupplies()" style="background: var(--dusty-rose); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem;">
                            📤 匯出清單
                        </button>
                    </div>
                </div>
                
                <div id="suppliesList" style="max-height: 400px; overflow-y: auto;">
                    <!-- 耗材項目將在這裡動態生成 -->
                </div>
            </div>

            <!-- 統計資訊 -->
            <div style="background: var(--light-cream); border-radius: 0.75rem; padding: 1.5rem;">
                <h3 style="color: var(--deep-brown); margin-bottom: 1rem; font-weight: bold;">📈 統計資訊</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                    <div style="text-align: center;">
                        <div id="totalSupplies" style="font-size: 1.5rem; font-weight: bold; color: #3498db;">0</div>
                        <div style="font-size: 0.9rem; color: #666;">總耗材種類</div>
                    </div>
                    <div style="text-align: center;">
                        <div id="lowStockCount" style="font-size: 1.5rem; font-weight: bold; color: #f39c12;">0</div>
                        <div style="font-size: 0.9rem; color: #666;">庫存不足</div>
                    </div>
                    <div style="text-align: center;">
                        <div id="expiredCount" style="font-size: 1.5rem; font-weight: bold; color: #e74c3c;">0</div>
                        <div style="font-size: 0.9rem; color: #666;">已過期</div>
                    </div>
                    <div style="text-align: center;">
                        <div id="expiringSoonCount" style="font-size: 1.5rem; font-weight: bold; color: #e67e22;">0</div>
                        <div style="font-size: 0.9rem; color: #666;">即將過期</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 範本編輯器彈跳視窗 -->
    <div id="templateEditor" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #DCC677; font-size: 1.8rem; font-weight: bold; margin: 0;">⚙️ 範本編輯器</h2>
                <button class="close-btn" onclick="hideTemplateEditor()" style="color: #DCC677;">✖</button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <p style="color: #666; margin-bottom: 1rem;">您可以自定義快速範本的內容，讓日誌記錄更符合您的工作習慣。</p>
            </div>
            
            <div style="display: grid; gap: 2rem;">
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: var(--deep-brown);">📋 範本1</label>
                    <input type="text" id="routineName" class="form-input" placeholder="範本名稱..." style="margin-bottom: 0.5rem;">
                    <textarea id="routineTemplate" rows="4" class="form-input" placeholder="輸入範本內容..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: var(--deep-brown);">🤝 範本2</label>
                    <input type="text" id="meetingName" class="form-input" placeholder="範本名稱..." style="margin-bottom: 0.5rem;">
                    <textarea id="meetingTemplate" rows="4" class="form-input" placeholder="輸入範本內容..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: var(--deep-brown);">🚨 範本3</label>
                    <input type="text" id="emergencyName" class="form-input" placeholder="範本名稱..." style="margin-bottom: 0.5rem;">
                    <textarea id="emergencyTemplate" rows="4" class="form-input" placeholder="輸入範本內容..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: var(--deep-brown);">💪 範本4</label>
                    <input type="text" id="healthName" class="form-input" placeholder="範本名稱..." style="margin-bottom: 0.5rem;">
                    <textarea id="healthTemplate" rows="4" class="form-input" placeholder="輸入範本內容..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-weight: bold; margin-bottom: 0.5rem; color: var(--deep-brown);">📚 範本5</label>
                    <input type="text" id="trainingName" class="form-input" placeholder="範本名稱..." style="margin-bottom: 0.5rem;">
                    <textarea id="trainingTemplate" rows="4" class="form-input" placeholder="輸入範本內容..."></textarea>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--pale-blue);">
                <button onclick="saveTemplates()" style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                    ✅ 儲存範本
                </button>
                <button onclick="resetTemplates()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                    🔄 重設為預設
                </button>
                <button onclick="hideTemplateEditor()" style="background: var(--neutral-grey); color: white; border: none; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                    ❌ 取消
                </button>
            </div>
        </div>
    </div>

    <!-- 備份設定彈跳視窗 -->
    <div id="backupSettingsModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: #8e44ad; font-size: 1.8rem; font-weight: bold; margin: 0;">💾 自動備份設定</h2>
                <button class="close-btn" onclick="hideBackupSettings()" style="color: #8e44ad;">✖</button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">
                    <h4 style="color: #2e7d32; margin: 0 0 0.5rem 0;">📊 備份狀態</h4>
                    <div id="backupStatus" style="color: #2e7d32; font-size: 0.9rem;">
                        <p>🕒 上次備份：<span id="lastBackupTime">從未備份</span></p>
                        <p>📁 總資料量：<span id="dataCount">0</span> 筆記錄</p>
                        <p>⚡ 自動備份：<span id="autoBackupStatus">已停用</span></p>
                    </div>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #8e44ad; margin-bottom: 1rem;">⚙️ 自動備份設定</h3>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                            <input type="checkbox" id="enableAutoBackup" onchange="toggleAutoBackup()" style="margin-right: 0.5rem;">
                            <span style="font-weight: bold;">啟用自動備份</span>
                        </label>
                    </div>

                    <div id="autoBackupOptions" style="display: none;">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">備份頻率：</label>
                            <select id="backupFrequency" class="form-input" onchange="updateBackupFrequency()">
                                <option value="daily">每日備份</option>
                                <option value="weekly" selected>每週備份</option>
                                <option value="biweekly">每兩週備份</option>
                                <option value="monthly">每月備份</option>
                            </select>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">備份時機：</label>
                            <select id="backupTrigger" class="form-input">
                                <option value="startup">系統啟動時</option>
                                <option value="datachange" selected>資料變更時</option>
                                <option value="both">啟動時 + 資料變更時</option>
                            </select>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="keepBackupHistory" checked style="margin-right: 0.5rem;">
                                <span>保留備份歷史（最多5個檔案）</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #8e44ad; margin-bottom: 1rem;">🔔 備份提醒</h3>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                            <input type="checkbox" id="enableBackupReminder" onchange="toggleBackupReminder()" style="margin-right: 0.5rem;">
                            <span style="font-weight: bold;">啟用備份提醒</span>
                        </label>
                    </div>

                    <div id="reminderOptions" style="display: none;">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem;">提醒頻率：</label>
                            <select id="reminderFrequency" class="form-input">
                                <option value="3">3天未備份時提醒</option>
                                <option value="7" selected>7天未備份時提醒</option>
                                <option value="14">14天未備份時提醒</option>
                                <option value="30">30天未備份時提醒</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #8e44ad; margin-bottom: 1rem;">🚀 立即操作</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <button onclick="createManualBackup()" style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; padding: 0.75rem; border-radius: 0.5rem; cursor: pointer; font-weight: bold;">
                            💾 立即備份
                        </button>
                        <button onclick="testAutoBackup()" style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; border: none; padding: 0.75rem; border-radius: 0.5rem; cursor: pointer; font-weight